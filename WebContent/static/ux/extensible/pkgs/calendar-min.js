Ext.ensible.cal.DayHeaderTemplate=function(b){Ext.apply(this,b);this.allDayTpl=new Ext.ensible.cal.BoxLayoutTemplate(b);this.allDayTpl.compile();Ext.ensible.cal.DayHeaderTemplate.superclass.constructor.call(this,'<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tbody>","</table>","</div>")};Ext.extend(Ext.ensible.cal.DayHeaderTemplate,Ext.XTemplate,{applyTemplate:function(b){return Ext.ensible.cal.DayHeaderTemplate.superclass.applyTemplate.call(this,{allDayTpl:this.allDayTpl.apply(b)})}});Ext.ensible.cal.DayHeaderTemplate.prototype.apply=Ext.ensible.cal.DayHeaderTemplate.prototype.applyTemplate;Ext.ensible.cal.DayBodyTemplate=function(b){Ext.apply(this,b);Ext.ensible.cal.DayBodyTemplate.superclass.constructor.call(this,'<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0" style="height:{dayHeight}px;">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<div class="ext-cal-bg-row ext-row-{[xindex]}" style="height:{parent.hourHeight}px;">','<div class="ext-cal-bg-row-div {parent.hourSeparatorCls}" style="height:{parent.hourSeparatorHeight}px;"></div>',"</div>","</tpl>","</div>","</div>","</td>","</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row" style="height:{parent.hourHeight}px;">','<div class="ext-cal-day-time-inner"  style="height:{parent.hourHeight-1}px;">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<div class="ext-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="ext-cal-day-col-gutter" style="height:{parent.dayHeight}px;"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>")};Ext.extend(Ext.ensible.cal.DayBodyTemplate,Ext.XTemplate,{applyTemplate:function(q){this.today=new Date().clearTime();this.dayCount=this.dayCount||1;var n=0,i=[],p=q.viewStart.clone();for(;n<this.dayCount;n++){i[n]=p.add(Date.DAY,n)}var t=[],s=this.viewStartHour,o=this.viewEndHour,r=this.hourIncrement,m=this.hourHeight*(o-s);fmt=Ext.ensible.Date.use24HourTime?"G:i":"ga";p=new Date("1/1/2010").clearTime().add(Date.HOUR,s);for(n=s;n<o;n++){t.push(p.format(fmt));p=p.add(Date.MINUTE,r)}return Ext.ensible.cal.DayBodyTemplate.superclass.applyTemplate.call(this,{days:i,dayCount:i.length,times:t,hourHeight:this.hourHeight,hourSeparatorCls:this.showHourSeparator?"":"no-sep",dayHeight:m,hourSeparatorHeight:(this.hourHeight/2)-1})}});Ext.ensible.cal.DayBodyTemplate.prototype.apply=Ext.ensible.cal.DayBodyTemplate.prototype.applyTemplate;Ext.ensible.cal.BoxLayoutTemplate=function(e){Ext.apply(this,e);var c=this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"";Ext.ensible.cal.BoxLayoutTemplate.superclass.constructor.call(this,'<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',c,'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&#160;</td>',"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(b,a){return((b-1)*(100/a))},getRowHeight:function(a){return 100/a}})};Ext.extend(Ext.ensible.cal.BoxLayoutTemplate,Ext.XTemplate,{firstWeekDateFormat:"D j",otherWeeksDateFormat:"j",singleDayDateFormat:"l, F j, Y",multiDayFirstDayFormat:"M j, Y",multiDayMonthStartFormat:"M j",applyTemplate:function(C){Ext.apply(this,C);var F=0,w="",J=true,o=false,H=false,x=false,N=false,D=false,K=C.weekendCls,B=C.prevMonthCls,y=C.nextMonthCls,M=C.todayCls,I=[[]],z=new Date().clearTime(),E=this.viewStart.clone(),L=this.startDate.getMonth();for(;F<this.weekCount||this.weekCount==-1;F++){if(E>this.viewEnd){break}I[F]=[];for(var A=0;A<this.dayCount;A++){o=E.getTime()===z.getTime();H=J||(E.getDate()==1);x=(E.getMonth()<L)&&this.weekCount==-1;N=(E.getMonth()>L)&&this.weekCount==-1;D=E.getDay()%6===0;if(E.getDay()==1){I[F].weekNum=this.showWeekNumbers?E.format("W"):"&#160;";I[F].weekLinkId="ext-cal-week-"+E.format("Ymd")}if(H){if(o){w=this.getTodayText()}else{w=E.format(this.dayCount==1?this.singleDayDateFormat:(J?this.multiDayFirstDayFormat:this.multiDayMonthStartFormat))}}else{var G=(F==0&&this.showHeader!==true)?this.firstWeekDateFormat:this.otherWeeksDateFormat;w=o?this.getTodayText():E.format(G)}I[F].push({title:w,date:E.clone(),titleCls:"ext-cal-dtitle "+(o?" ext-cal-dtitle-today":"")+(F==0?" ext-cal-dtitle-first":"")+(x?" ext-cal-dtitle-prev":"")+(N?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(o?" "+M:"")+(A==0?" ext-cal-day-first":"")+(x?" "+B:"")+(N?" "+y:"")+(D&&K?" "+K:"")});E=E.add(Date.DAY,1);J=false}}return Ext.ensible.cal.BoxLayoutTemplate.superclass.applyTemplate.call(this,{weeks:I})},getTodayText:function(){var f=Ext.ensible.Date.use24HourTime?"G:i ":"g:ia ",i=this.showTodayText!==false?this.todayText:"",g=this.showTime!==false?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time" aria-live="off">'+new Date().format(f)+"</span>":"",h=i.length>0||g.length>0?" &#8212; ":"";if(this.dayCount==1){return new Date().format(this.singleDayDateFormat)+h+i+g}fmt=this.weekCount==1?this.firstWeekDateFormat:this.otherWeeksDateFormat;return i.length>0?i+g:new Date().format(fmt)+g}});Ext.ensible.cal.BoxLayoutTemplate.prototype.apply=Ext.ensible.cal.BoxLayoutTemplate.prototype.applyTemplate;Ext.ensible.cal.MonthViewTemplate=function(e){Ext.apply(this,e);this.weekTpl=new Ext.ensible.cal.BoxLayoutTemplate(e);this.weekTpl.compile();var c=this.showWeekLinks?'<div class="ext-cal-week-link-hd">&#160;</div>':"";Ext.ensible.cal.MonthViewTemplate.superclass.constructor.call(this,'<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',c,'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{title}">{name}</th>',"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>")};Ext.extend(Ext.ensible.cal.MonthViewTemplate,Ext.XTemplate,{dayHeaderFormat:"D",dayHeaderTitleFormat:"l, F j, Y",applyTemplate:function(m){var l=[],o=this.weekTpl.apply(m),p=m.viewStart;for(var i=0;i<7;i++){var n=p.add(Date.DAY,i);l.push({name:n.format(this.dayHeaderFormat),title:n.format(this.dayHeaderTitleFormat)})}var k=this.showHeader===true?"":"ext-cal-noheader";if(this.showWeekLinks){k+=" ext-cal-week-links"}return Ext.ensible.cal.MonthViewTemplate.superclass.applyTemplate.call(this,{days:l,weeks:o,extraClasses:k})}});Ext.ensible.cal.MonthViewTemplate.prototype.apply=Ext.ensible.cal.MonthViewTemplate.prototype.applyTemplate;Ext.dd.ScrollManager=function(){var t=Ext.dd.DragDropMgr;var r={};var u=null;var o={};var p=function(a){u=null;v()};var n=function(){if(t.dragCurrent){t.refreshCache(t.dragCurrent.groups)}};var s=function(){if(t.dragCurrent){var a=Ext.dd.ScrollManager;var b=o.el.ddScrollConfig?o.el.ddScrollConfig.increment:a.increment;if(!a.animate){if(o.el.scroll(o.dir,b)){n()}}else{o.el.scroll(o.dir,b,true,a.animDuration,n)}}};var v=function(){if(o.id){clearInterval(o.id)}o.id=0;o.el=null;o.dir=""};var q=function(e,a){v();o.el=e;o.dir=a;var b=(e.ddScrollConfig&&e.ddScrollConfig.frequency)?e.ddScrollConfig.frequency:Ext.dd.ScrollManager.frequency,c=e.ddScrollConfig?e.ddScrollConfig.ddGroup:undefined;if(c===undefined||t.dragCurrent.ddGroup==c){o.id=setInterval(s,b)}};var m=function(b,k){if(k||!t.dragCurrent){return}var i=Ext.dd.ScrollManager;if(!u||u!=t.dragCurrent){u=t.dragCurrent;i.refreshCache()}var h=Ext.lib.Event.getXY(b);var g=new Ext.lib.Point(h[0],h[1]);for(var e in r){var c=r[e],f=c._region;var a=c.ddScrollConfig?c.ddScrollConfig:i;if(f&&f.contains(g)&&c.isScrollable()){if(f.bottom-g.y<=a.vthresh){if(o.el!=c){q(c,"down")}return}else{if(f.right-g.x<=a.hthresh){if(o.el!=c){q(c,"left")}return}else{if(g.y-f.top<=a.vthresh){if(o.el!=c){q(c,"up")}return}else{if(g.x-f.left<=a.hthresh){if(o.el!=c){q(c,"right")}return}}}}}}v()};t.fireEvents=t.fireEvents.createSequence(m,t);t.stopDrag=t.stopDrag.createSequence(p,t);return{register:function(b){if(Ext.isArray(b)){for(var c=0,a=b.length;c<a;c++){this.register(b[c])}}else{b=Ext.get(b);r[b.id]=b}},unregister:function(b){if(Ext.isArray(b)){for(var c=0,a=b.length;c<a;c++){this.unregister(b[c])}}else{b=Ext.get(b);delete r[b.id]}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:0.4,refreshCache:function(){for(var a in r){if(typeof r[a]=="object"){r[a]._region=r[a].getRegion()}}}}}();Ext.ensible.cal.StatusProxy=function(b){Ext.apply(this,b);this.id=this.id||Ext.id();this.el=new Ext.Layer({dh:{id:this.id,cls:"ext-dd-drag-proxy x-dd-drag-proxy "+this.dropNotAllowed,cn:[{cls:"x-dd-drop-icon"},{cls:"ext-dd-ghost-ct",cn:[{cls:"x-dd-drag-ghost"},{cls:"ext-dd-msg"}]}]},shadow:!b||b.shadow!==false});this.ghost=Ext.get(this.el.dom.childNodes[1].childNodes[0]);this.message=Ext.get(this.el.dom.childNodes[1].childNodes[1]);this.dropStatus=this.dropNotAllowed};Ext.extend(Ext.ensible.cal.StatusProxy,Ext.dd.StatusProxy,{moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",update:function(e){if(typeof e=="string"){this.ghost.update(e)}else{this.ghost.update("");e.style.margin="0";this.ghost.dom.appendChild(e)}var c=this.ghost.dom.firstChild;if(c){Ext.fly(c).setStyle("float","none").setHeight("auto");Ext.getDom(c).id+="-ddproxy"}},updateMsg:function(b){this.message.update(b)}});Ext.ensible.cal.DragZone=Ext.extend(Ext.dd.DragZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",constructor:function(c,e){if(!Ext.ensible.cal._statusProxyInstance){Ext.ensible.cal._statusProxyInstance=new Ext.ensible.cal.StatusProxy()}this.proxy=Ext.ensible.cal._statusProxyInstance;Ext.ensible.cal.DragZone.superclass.constructor.call(this,c,e)},getDragData:function(e){var f=e.getTarget(this.eventSelector,3);if(f){var g=this.view.getEventRecordFromEl(f);if(!g){return}return{type:"eventdrag",ddel:f,eventStart:g.data[Ext.ensible.cal.EventMappings.StartDate.name],eventEnd:g.data[Ext.ensible.cal.EventMappings.EndDate.name],proxy:this.proxy}}f=this.view.getDayAt(e.xy[0],e.xy[1]);if(f.el){return{type:"caldrag",start:f.date,proxy:this.proxy}}return null},onInitDrag:function(g,h){if(this.dragData.ddel){var f=this.dragData.ddel.cloneNode(true),i=Ext.fly(f).child("dl");Ext.fly(f).setWidth("auto");if(i){i.setHeight("auto")}this.proxy.update(f);this.onStartDrag(g,h)}else{if(this.dragData.start){this.onStartDrag(g,h)}}this.view.onInitDrag();return true},afterRepair:function(){if(Ext.enableFx&&this.dragData.ddel){Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")}this.dragging=false},getRepairXY:function(b){if(this.dragData.ddel){return Ext.Element.fly(this.dragData.ddel).getXY()}},afterInvalidDrop:function(e,c){Ext.select(".ext-dd-shim").hide()},destroy:function(){Ext.ensible.cal.DragZone.superclass.destroy.call(this);delete Ext.ensible.cal._statusProxyInstance}});Ext.ensible.cal.DropZone=Ext.extend(Ext.dd.DropZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",shims:[],getTargetFromEvent:function(e){var g=this.dragOffset||0,h=e.getPageY()-g,i=this.view.getDayAt(e.getPageX(),h);return i.el?i:null},onNodeOver:function(q,e,m,o){var t=Ext.ensible.Date,s=o.type=="eventdrag"?q.date:t.min(o.start,q.date),p=o.type=="eventdrag"?q.date.add(Date.DAY,t.diffDays(o.eventStart,o.eventEnd)):t.max(o.start,q.date);if(!this.dragStartDate||!this.dragEndDate||(t.diffDays(s,this.dragStartDate)!=0)||(t.diffDays(p,this.dragEndDate)!=0)){this.dragStartDate=s;this.dragEndDate=p.clearTime().add(Date.DAY,1).add(Date.MINUTE,-30);this.shim(s,p);var n=s.format(this.dateFormat);if(t.diffDays(s,p)>0){p=p.format(this.dateFormat);n=String.format(this.dateRangeFormat,n,p)}var r=String.format(o.type=="eventdrag"?this.moveText:this.createText,n);o.proxy.updateMsg(r)}return this.dropAllowed},shim:function(t,p){this.currWeek=-1;var s=t.clone(),o=0,q,n,r=Ext.ensible.Date.diffDays(s,p)+1;Ext.each(this.shims,function(a){if(a){a.isActive=false}});while(o++<r){var m=this.view.getDayEl(s);if(m){var i=this.view.getWeekIndex(s),q=this.shims[i];if(!q){q=this.createShim();this.shims[i]=q}if(i!=this.currWeek){q.boxInfo=m.getBox();this.currWeek=i}else{n=m.getBox();q.boxInfo.right=n.right;q.boxInfo.width=n.right-q.boxInfo.x}q.isActive=true}s=s.add(Date.DAY,1)}Ext.each(this.shims,function(a){if(a){if(a.isActive){a.show();a.setBox(a.boxInfo)}else{if(a.isVisible()){a.hide()}}}})},createShim:function(){var e=this.view.ownerCalendarPanel?this.view.ownerCalendarPanel:this.view;if(!this.shimCt){this.shimCt=Ext.get("ext-dd-shim-ct-"+e.id);if(!this.shimCt){this.shimCt=document.createElement("div");this.shimCt.id="ext-dd-shim-ct-"+e.id;e.getEl().parent().appendChild(this.shimCt)}}var c=document.createElement("div");c.className="ext-dd-shim";this.shimCt.appendChild(c);return new Ext.Layer({shadow:false,useDisplay:true,constrain:false},c)},clearShims:function(){Ext.each(this.shims,function(b){if(b){b.hide()}})},onContainerOver:function(f,g,e){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate;delete this.dragEndDate;this.clearShims()},onNodeDrop:function(k,i,m,n){if(k&&n){if(n.type=="eventdrag"){var l=this.view.getEventRecordFromEl(n.ddel),e=Ext.ensible.Date.copyTime(l.data[Ext.ensible.cal.EventMappings.StartDate.name],k.date);this.view.onEventDrop(l,e);this.onCalendarDragComplete();return true}if(n.type=="caldrag"){this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false},onContainerDrop:function(f,g,e){this.onCalendarDragComplete();return false},destroy:function(){Ext.each(this.shims,function(b){if(b){Ext.destroy(b)}});Ext.removeNode(this.shimCt);delete this.shimCt;this.shims.length=0}});Ext.ensible.cal.DayViewDragZone=Ext.extend(Ext.ensible.cal.DragZone,{ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(i){var g=i.getTarget(this.resizeSelector,2,true);if(g){var e=g.parent(this.eventSelector),h=this.view.getEventRecordFromEl(e);if(!h){return}return{type:"eventresize",xy:i.xy,ddel:e.dom,eventStart:h.data[Ext.ensible.cal.EventMappings.StartDate.name],eventEnd:h.data[Ext.ensible.cal.EventMappings.EndDate.name],proxy:this.proxy}}var g=i.getTarget(this.eventSelector,3);if(g){var h=this.view.getEventRecordFromEl(g);if(!h){return}return{type:"eventdrag",xy:i.xy,ddel:g,eventStart:h.data[Ext.ensible.cal.EventMappings.StartDate.name],eventEnd:h.data[Ext.ensible.cal.EventMappings.EndDate.name],proxy:this.proxy}}g=this.view.getDayAt(i.xy[0],i.xy[1]);if(g.el){return{type:"caldrag",dayInfo:g,proxy:this.proxy}}return null}});Ext.ensible.cal.DayViewDropZone=Ext.extend(Ext.ensible.cal.DropZone,{ddGroup:"DayViewDD",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",onNodeOver:function(D,u,w,z){var E,n=this.createText,A=Ext.ensible.Date.use24HourTime?"G:i":"g:ia";if(z.type=="caldrag"){if(!this.dragStartMarker){this.dragStartMarker=D.el.parent().createChild({style:"position:absolute;"});this.dragStartMarker.setBox(z.dayInfo.timeBox);this.dragCreateDt=z.dayInfo.date}var x,y=this.dragStartMarker.getBox();y.height=Math.ceil(Math.abs(w.xy[1]-y.y)/D.timeBox.height)*D.timeBox.height;if(w.xy[1]<y.y){y.height+=D.timeBox.height;y.y=y.y-y.height+D.timeBox.height;x=this.dragCreateDt.add(Date.MINUTE,this.ddIncrement)}else{D.date=D.date.add(Date.MINUTE,this.ddIncrement)}this.shim(this.dragCreateDt,y);var v=Ext.ensible.Date.diff(this.dragCreateDt,D.date),G=this.dragCreateDt.add(Date.MILLI,v);this.dragStartDate=Ext.ensible.Date.min(this.dragCreateDt,G);this.dragEndDate=x||Ext.ensible.Date.max(this.dragCreateDt,G);E=String.format(this.dateRangeFormat,this.dragStartDate.format(A),this.dragEndDate.format(A))}else{var H=Ext.get(z.ddel),e=H.parent().parent(),y=H.getBox();y.width=e.getWidth();if(z.type=="eventdrag"){if(this.dragOffset===undefined){var C=this.view.getDayAt(z.xy[0],z.xy[1]).timeBox;this.dragOffset=C.y-y.y}else{y.y=D.timeBox.y}E=D.date.format(this.dateFormat+" "+A);y.x=D.el.getLeft();this.shim(D.date,y);n=this.moveText}if(z.type=="eventresize"){if(!this.resizeDt){this.resizeDt=D.date}y.x=e.getLeft();y.height=Math.ceil(Math.abs(w.xy[1]-y.y)/D.timeBox.height)*D.timeBox.height;if(w.xy[1]<y.y){y.y-=y.height}else{D.date=D.date.add(Date.MINUTE,this.ddIncrement)}this.shim(this.resizeDt,y);var v=Ext.ensible.Date.diff(this.resizeDt,D.date),G=this.resizeDt.add(Date.MILLI,v),F=Ext.ensible.Date.min(z.eventStart,G),B=Ext.ensible.Date.max(z.eventStart,G);z.resizeDates={StartDate:F,EndDate:B};E=String.format(this.dateRangeFormat,F.format(A),B.format(A));n=this.resizeText}}z.proxy.updateMsg(String.format(n,E));return this.dropAllowed},shim:function(e,f){Ext.each(this.shims,function(a){if(a){a.isActive=false;a.hide()}});var g=this.shims[0];if(!g){g=this.createShim();this.shims[0]=g}g.isActive=true;g.show();g.setBox(f)},onNodeDrop:function(i,h,l,e){if(i&&e){if(e.type=="eventdrag"){var k=this.view.getEventRecordFromEl(e.ddel);this.view.onEventDrop(k,i.date);this.onCalendarDragComplete();delete this.dragOffset;return true}if(e.type=="eventresize"){var k=this.view.getEventRecordFromEl(e.ddel);this.view.onEventResize(k,e.resizeDates);this.onCalendarDragComplete();delete this.resizeDt;return true}if(e.type=="caldrag"){Ext.destroy(this.dragStartMarker);delete this.dragStartMarker;delete this.dragCreateDt;this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false}});Ext.ensible.cal.EventStore=Ext.extend(Ext.data.Store,{constructor:function(b){this.deferLoad=b.autoLoad;b.autoLoad=false;Ext.ensible.cal.EventStore.superclass.constructor.apply(this,arguments)},load:function(b){Ext.ensible.log("store load");if(b.params){delete this.initialParams}if(this.initialParams){b=Ext.isObject(b)?b:{};b.params=b.params||{};Ext.apply(b.params,this.initialParams);delete this.initialParams}Ext.ensible.cal.EventStore.superclass.load.call(this,b)}});Ext.reg("extensible.eventstore",Ext.ensible.cal.EventStore);Ext.ensible.cal.EventMappings={EventId:{name:"EventId",mapping:"id",type:"int"},CalendarId:{name:"CalendarId",mapping:"cid",type:"int"},Title:{name:"Title",mapping:"title",type:"string"},StartDate:{name:"StartDate",mapping:"start",type:"date",dateFormat:"c"},EndDate:{name:"EndDate",mapping:"end",type:"date",dateFormat:"c"},RRule:{name:"RecurRule",mapping:"recur_rule"},Location:{name:"Location",mapping:"loc",type:"string"},Notes:{name:"Notes",mapping:"notes",type:"string"},Url:{name:"Url",mapping:"url",type:"string"},IsAllDay:{name:"IsAllDay",mapping:"ad",type:"boolean"},Reminder:{name:"Reminder",mapping:"rem",type:"string"}};Ext.ensible.cal.CalendarMappings={CalendarId:{name:"CalendarId",mapping:"id",type:"int"},Title:{name:"Title",mapping:"title",type:"string"},Description:{name:"Description",mapping:"desc",type:"string"},ColorId:{name:"ColorId",mapping:"color",type:"int"},IsHidden:{name:"IsHidden",mapping:"hidden",type:"boolean"}};Ext.ensible.cal.EventRecord=Ext.extend(Ext.data.Record,{fields:new Ext.util.MixedCollection(false,function(b){return b.name})});Ext.ensible.cal.EventRecord.reconfigure=function(){var l=Ext.ensible.cal,k=l.EventMappings,m=l.EventRecord.prototype,h=[];for(prop in k){if(k.hasOwnProperty(prop)){h.push(k[prop])}}m.fields.clear();for(var n=0,i=h.length;n<i;n++){m.fields.add(new Ext.data.Field(h[n]))}return l.EventRecord};Ext.ensible.cal.EventRecord.reconfigure();Ext.ensible.cal.CalendarRecord=Ext.extend(Ext.data.Record,{fields:new Ext.util.MixedCollection(false,function(b){return b.name})});Ext.ensible.cal.CalendarRecord.reconfigure=function(){var l=Ext.ensible.cal,k=l.CalendarMappings,m=l.CalendarRecord.prototype,h=[];for(prop in k){if(k.hasOwnProperty(prop)){h.push(k[prop])}}m.fields.clear();for(var n=0,i=h.length;n<i;n++){m.fields.add(new Ext.data.Field(h[n]))}return l.CalendarRecord};Ext.ensible.cal.CalendarRecord.reconfigure();Ext.ensible.cal.WeekEventRenderer=function(){var e=function(p,o,a){var l=1,b=Ext.get(p+"-wk-"+o),m,n;if(b){n=b.child(".ext-cal-evt-tbl",true);m=n.tBodies[0].childNodes[a+l];if(!m){m=Ext.DomHelper.append(n.tBodies[0],"<tr></tr>")}}return Ext.get(m)};var c=function(B,v,D,C,E,z,A){var w=Ext.ensible.cal.EventMappings,t=B.data||B.event.data,b=z.clone(),a=b.add(Date.DAY,E-D).add(Date.MILLI,-1),y=e(A.viewId,v,C),u=Ext.ensible.Date.diffDays(z,t[w.EndDate.name])+1,x=Math.min(u,E-D);t._weekIndex=v;t._renderAsAllDay=t[w.IsAllDay.name]||B.isSpanStart;t.spanLeft=t[w.StartDate.name].getTime()<b.getTime();t.spanRight=t[w.EndDate.name].getTime()>a.getTime();t.spanCls=(t.spanLeft?(t.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft"):(t.spanRight?"ext-cal-ev-spanright":""));var F={tag:"td",cls:"ext-cal-ev",cn:A.tpl.apply(A.templateDataFn(t))};if(x>1){F.colspan=x}Ext.DomHelper.append(y,F)};return{render:function(B){var b=this,a="&#160;",E=0,O=B.eventGrid,N=B.viewStart.clone(),K="",J=B.tpl,G=B.maxEventsPerDay!=undefined?B.maxEventsPerDay:999,D=B.weekCount<1?6:B.weekCount,I=B.weekCount==1?B.dayCount:7,C,H,T,Q,P,F,R,L,M,S;for(;E<D;E++){H=0;T=O[E];for(;H<I;H++){if(T&&T[H]){Q=0;P=0;F=T[H];R=F.length;K=N.format("Ymd");for(;Q<R;Q++){if(!F[Q]){if(Q>=G){continue}C=e(B.viewId,E,Q);Ext.DomHelper.append(C,{tag:"td",cls:"ext-cal-ev",html:a,id:B.viewId+"-empty-"+R+"-day-"+K})}else{if(Q>=G){P++;continue}L=F[Q];if(!L.isSpan||L.isSpanStart){c(L,E,H,Q,I,N,B)}}}if(P>0){C=e(B.viewId,E,G);Ext.DomHelper.append(C,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+N.format("Ymd"),cn:{tag:"a",html:String.format(B.getMoreText(P),P)}})}else{if(R<B.evtMaxCount[E]){C=e(B.viewId,E,R);if(C){M={tag:"td",cls:"ext-cal-ev",html:a,id:B.viewId+"-empty-"+(R+1)+"-day-"+K};var A=B.evtMaxCount[E]-R;if(A>1){M.rowspan=A}Ext.DomHelper.append(C,M)}}}}else{C=e(B.viewId,E,0);if(C){M={tag:"td",cls:"ext-cal-ev",html:a,id:B.viewId+"-empty-day-"+K};if(B.evtMaxCount[E]>1){M.rowspan=B.evtMaxCount[E]}Ext.DomHelper.append(C,M)}}N=N.add(Date.DAY,1)}}}}}();Ext.ensible.cal.CalendarCombo=Ext.extend(Ext.form.ComboBox,{fieldLabel:"Calendar",triggerAction:"all",mode:"local",forceSelection:true,selectOnFocus:true,width:200,defaultCls:"x-cal-default",initComponent:function(){var e=Ext.ensible.cal,c=e.CalendarMappings;e.CalendarCombo.superclass.initComponent.call(this);this.valueField=c.CalendarId.name;this.displayField=c.Title.name;this.tpl=this.tpl||'<tpl for="."><div class="x-combo-list-item x-cal-{'+c.ColorId.name+'}"><div class="ext-cal-picker-icon">&#160;</div>{'+this.displayField+"}</div></tpl>"},afterRender:function(){Ext.ensible.cal.CalendarCombo.superclass.afterRender.call(this);this.wrap=this.el.up(".x-form-field-wrap");this.wrap.addClass("ext-calendar-picker");this.icon=Ext.DomHelper.append(this.wrap,{tag:"div",cls:"ext-cal-picker-icon ext-cal-picker-mainicon"})},assertValue:function(){var c=this.getRawValue(),e=this.findRecord(this.displayField,c);if(!e&&this.forceSelection){if(c.length>0&&c!=this.emptyText){this.store.clearFilter();this.setValue(this.value);this.applyEmptyText()}else{this.clearValue()}}else{if(e){if(c==e.get(this.displayField)&&this.value==e.get(this.valueField)){return}c=e.get(this.valueField||this.displayField)}this.setValue(c)}},getStyleClass:function(e){if(e&&e!==""){var c=this.store.getById(e);return"x-cal-"+c.data[Ext.ensible.cal.CalendarMappings.ColorId.name]}},setValue:function(b){this.wrap.removeClass(this.getStyleClass(this.getValue()));b=b||this.store.getAt(0).data[Ext.ensible.cal.CalendarMappings.CalendarId.name];Ext.ensible.cal.CalendarCombo.superclass.setValue.call(this,b);this.wrap.addClass(this.getStyleClass(b))}});Ext.reg("extensible.calendarcombo",Ext.ensible.cal.CalendarCombo);Ext.ensible.cal.RecurrenceCombo=Ext.extend(Ext.form.ComboBox,{width:160,fieldLabel:"Repeats",mode:"local",triggerAction:"all",forceSelection:true,displayField:"pattern",valueField:"id",recurrenceText:{none:"Does not repeat",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"},initComponent:function(){Ext.ensible.cal.RecurrenceCombo.superclass.initComponent.call(this);this.addEvents("recurrencechange");this.store=this.store||new Ext.data.ArrayStore({fields:["id","pattern"],idIndex:0,data:[["NONE",this.recurrenceText.none],["DAILY",this.recurrenceText.daily],["WEEKLY",this.recurrenceText.weekly],["MONTHLY",this.recurrenceText.monthly],["YEARLY",this.recurrenceText.yearly]]})},initValue:function(){Ext.ensible.cal.RecurrenceCombo.superclass.initValue.call(this);if(this.value!=undefined){this.fireEvent("recurrencechange",this.value)}},setValue:function(c){var e=this.value;Ext.ensible.cal.RecurrenceCombo.superclass.setValue.call(this,c);if(e!=c){this.fireEvent("recurrencechange",c)}return this}});Ext.reg("extensible.recurrencecombo",Ext.ensible.cal.RecurrenceCombo);Ext.ensible.cal.RecurrenceField=Ext.extend(Ext.form.Field,{fieldLabel:"Repeats",startDate:new Date().clearTime(),enableFx:true,initComponent:function(){Ext.ensible.cal.RecurrenceField.superclass.initComponent.call(this);if(!this.height){this.autoHeight=true}},onRender:function(c,e){if(!this.el){this.frequencyCombo=new Ext.ensible.cal.RecurrenceCombo({id:this.id+"-frequency",listeners:{recurrencechange:{fn:this.showOptions,scope:this}}});if(this.fieldLabel){this.frequencyCombo.fieldLabel=this.fieldLabel}this.innerCt=new Ext.Container({cls:"extensible-recur-inner-ct",items:[]});this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"extensible-recur-ct",renderTo:c,items:[this.frequencyCombo,this.innerCt]});this.fieldCt.ownerCt=this;this.innerCt.ownerCt=this.fieldCt;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll(this.initSubComponents())}Ext.ensible.cal.RecurrenceField.superclass.onRender.call(this,c,e)},initValue:function(){this.setStartDate(this.startDate);if(this.value!==undefined){this.setValue(this.value)}else{if(this.frequency!==undefined){this.setValue("FREQ="+this.frequency)}else{this.setValue("NONE")}}this.originalValue=this.getValue()},showOptions:function(g){var e=false,f="day";if(g!="NONE"){this.hideSubPanels()}this.frequency=g;switch(g){case"DAILY":e=this.showSubPanel(this.repeatEvery);e|=this.showSubPanel(this.until);break;case"WEEKLY":e=this.showSubPanel(this.repeatEvery);e|=this.showSubPanel(this.weekly);e|=this.showSubPanel(this.until);f="week";break;case"MONTHLY":e=this.showSubPanel(this.repeatEvery);e|=this.showSubPanel(this.monthly);e|=this.showSubPanel(this.until);f="month";break;case"YEARLY":e=this.showSubPanel(this.repeatEvery);e|=this.showSubPanel(this.yearly);e|=this.showSubPanel(this.until);f="year";break;default:this.hideInnerCt();return}if(e){this.innerCt.doLayout()}this.showInnerCt();this.repeatEvery.updateLabel(f)},showSubPanel:function(b){if(b.rendered){b.show();return false}else{if(this.repeatEvery.rendered){b=this.innerCt.insert(1,b)}else{b=this.innerCt.add(b)}b.show();return true}},showInnerCt:function(){if(!this.innerCt.isVisible()){if(this.enableFx&&Ext.enableFx){this.innerCt.getPositionEl().slideIn("t",{duration:0.3})}else{this.innerCt.show()}}},hideInnerCt:function(){if(this.innerCt.isVisible()){if(this.enableFx&&Ext.enableFx){this.innerCt.getPositionEl().slideOut("t",{duration:0.3,easing:"easeIn",callback:this.hideSubPanels,scope:this})}else{this.innerCt.hide();this.hideSubPanels()}}},setStartDate:function(b){this.items.each(function(a){a.setStartDate(b)})},getValue:function(){if(!this.rendered){return this.value}if(this.frequency=="NONE"){return""}var b="FREQ="+this.frequency;this.items.each(function(a){if(a.isVisible()){b+=a.getValue()}});return b},setValue:function(e){this.value=e;if(e==null||e==""||e=="NONE"){this.frequencyCombo.setValue("NONE");this.showOptions("NONE");return this}var c=e.split(";");this.items.each(function(a){a.setValue(c)});Ext.each(c,function(a){if(a.indexOf("FREQ")>-1){var b=a.split("=")[1];this.frequencyCombo.setValue(b);this.showOptions(b);return}},this);return this},hideSubPanels:function(){this.items.each(function(b){b.hide()})},initSubComponents:function(){Ext.ensible.cal.recurrenceBase=Ext.extend(Ext.Container,{fieldLabel:" ",labelSeparator:"",hideLabel:true,layout:"table",anchor:"100%",startDate:this.startDate,getSuffix:function(b){if(!Ext.isNumber(b)){return""}switch(b){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},initNthCombo:function(y){var y=Ext.getCmp(this.id+"-combo"),E=this.startDate,u=y.getStore(),t=E.getLastDateOfMonth().getDate(),D=E.getDate(),s=E.format("jS")+" day",z=this.id.indexOf("-yearly")>-1,w=" in "+E.format("F"),A,C,x,F,v,B,r;A=Math.ceil(D/7);C=A+this.getSuffix(A)+E.format(" l");if(z){s+=w;C+=w}B=[[s],[C]];r=z?w:"";if(t-D<7){B.push(["last "+E.format("l")+r])}if(t==D){B.push(["last day"+r])}v=u.find("field1",y.getValue());u.removeAll();y.clearValue();u.loadData(B);if(v>B.length-1){v=B.length-1}y.setValue(u.getAt(v>-1?v:0).data.field1);return this},setValue:Ext.emptyFn});this.repeatEvery=new Ext.ensible.cal.recurrenceBase({id:this.id+"-every",layoutConfig:{columns:3},items:[{xtype:"label",text:"Repeat every"},{xtype:"numberfield",id:this.id+"-every-num",value:1,width:35,minValue:1,maxValue:99,allowBlank:false,enableKeyEvents:true,listeners:{keyup:{fn:function(){this.repeatEvery.updateLabel()},scope:this}}},{xtype:"label",id:this.id+"-every-label"}],setStartDate:function(b){this.startDate=b;this.updateLabel();return this},getValue:function(){var b=Ext.getCmp(this.id+"-num").getValue();return b>1?";INTERVAL="+b:""},setValue:function(f){var g=false,e=Ext.isArray(f)?f:f.split(";");Ext.each(e,function(a){if(a.indexOf("INTERVAL")>-1){var b=a.split("=")[1];Ext.getCmp(this.id+"-num").setValue(b)}},this);return this},updateLabel:function(e){if(this.rendered){var f=Ext.getCmp(this.id+"-num").getValue()==1?"":"s";this.type=e?e.toLowerCase():this.type||"day";var g=Ext.getCmp(this.id+"-label");if(g.rendered){g.update(this.type+f+" beginning "+this.startDate.format("l, F j"))}}return this},afterRender:function(){Ext.ensible.cal.recurrenceBase.superclass.afterRender.call(this);this.updateLabel()}});this.weekly=new Ext.ensible.cal.recurrenceBase({id:this.id+"-weekly",layoutConfig:{columns:2},items:[{xtype:"label",text:"on:"},{xtype:"checkboxgroup",id:this.id+"-weekly-days",items:[{boxLabel:"Sun",name:"SU",id:this.id+"-weekly-SU"},{boxLabel:"Mon",name:"MO",id:this.id+"-weekly-MO"},{boxLabel:"Tue",name:"TU",id:this.id+"-weekly-TU"},{boxLabel:"Wed",name:"WE",id:this.id+"-weekly-WE"},{boxLabel:"Thu",name:"TH",id:this.id+"-weekly-TH"},{boxLabel:"Fri",name:"FR",id:this.id+"-weekly-FR"},{boxLabel:"Sat",name:"SA",id:this.id+"-weekly-SA"}]}],setStartDate:function(b){this.startDate=b;this.selectToday();return this},selectToday:function(){this.clearValue();var b=this.startDate.format("D").substring(0,2).toUpperCase();Ext.getCmp(this.id+"-days").setValue(b,true)},clearValue:function(){Ext.getCmp(this.id+"-days").setValue([false,false,false,false,false,false,false])},getValue:function(){var e="",g=Ext.getCmp(this.id+"-days").getValue();Ext.each(g,function(a){if(e.length>0){e+=","}e+=a.name});var f=this.startDate.format("D").substring(0,2).toUpperCase();return e.length>0&&e!=f?";BYDAY="+e:""},setValue:function(f){var g=false,e=Ext.isArray(f)?f:f.split(";");this.clearValue();Ext.each(e,function(b){if(b.indexOf("BYDAY")>-1){var a=b.split("=")[1].split(","),c={};Ext.each(a,function(i){c[i]=true},this);Ext.getCmp(this.id+"-days").setValue(c);return g=true}},this);if(!g){this.selectToday()}return this}});this.monthly=new Ext.ensible.cal.recurrenceBase({id:this.id+"-monthly",layoutConfig:{columns:3},items:[{xtype:"label",text:"on the"},{xtype:"combo",id:this.id+"-monthly-combo",mode:"local",width:150,triggerAction:"all",forceSelection:true,store:[]},{xtype:"label",text:"of each month"}],setStartDate:function(b){this.startDate=b;this.initNthCombo();return this},getValue:function(){var i=Ext.getCmp(this.id+"-combo"),l=i.getStore(),h=l.find("field1",i.getValue()),k=this.startDate,g=k.format("D").substring(0,2).toUpperCase();if(h>-1){switch(h){case 0:return";BYMONTHDAY="+k.format("j");case 1:return";BYDAY="+i.getValue()[0].substring(0,1)+g;case 2:return";BYDAY=-1"+g;default:return";BYMONTHDAY=-1"}}return""}});this.yearly=new Ext.ensible.cal.recurrenceBase({id:this.id+"-yearly",layoutConfig:{columns:3},items:[{xtype:"label",text:"on the"},{xtype:"combo",id:this.id+"-yearly-combo",mode:"local",width:170,triggerAction:"all",forceSelection:true,store:[]},{xtype:"label",text:"each year"}],setStartDate:function(b){this.startDate=b;this.initNthCombo();return this},getValue:function(){var l=Ext.getCmp(this.id+"-combo"),n=l.getStore(),i=n.find("field1",l.getValue()),m=this.startDate,h=m.format("D").substring(0,2).toUpperCase(),k=";BYMONTH="+m.format("n");if(i>-1){switch(i){case 0:return k;case 1:return k+";BYDAY="+l.getValue()[0].substring(0,1)+h;case 2:return k+";BYDAY=-1"+h;default:return k+";BYMONTHDAY=-1"}}return""}});this.until=new Ext.ensible.cal.recurrenceBase({id:this.id+"-until",untilDateFormat:"Ymd\\T000000\\Z",layoutConfig:{columns:5},items:[{xtype:"label",text:"and continuing"},{xtype:"combo",id:this.id+"-until-combo",mode:"local",width:85,triggerAction:"all",forceSelection:true,value:"forever",store:["forever","for","until"],listeners:{select:{fn:function(e,g){var f=Ext.getCmp(this.id+"-until-date");if(g.data.field1=="until"){f.show();if(f.getValue()==""){f.setValue(this.startDate.add(Date.DAY,5));f.setMinValue(this.startDate.clone().add(Date.DAY,1))}}else{f.hide()}if(g.data.field1=="for"){Ext.getCmp(this.id+"-until-num").show();Ext.getCmp(this.id+"-until-endlabel").show()}else{Ext.getCmp(this.id+"-until-num").hide();Ext.getCmp(this.id+"-until-endlabel").hide()}},scope:this}}},{xtype:"datefield",id:this.id+"-until-date",showToday:false,hidden:true},{xtype:"numberfield",id:this.id+"-until-num",value:5,width:35,minValue:1,maxValue:99,allowBlank:false,hidden:true},{xtype:"label",id:this.id+"-until-endlabel",text:"occurrences",hidden:true}],setStartDate:function(b){this.startDate=b;return this},getValue:function(){var c=Ext.getCmp(this.id+"-date");if(c.isVisible()){return";UNTIL="+c.getValue().format(this.untilDateFormat)}var e=Ext.getCmp(this.id+"-num");if(e.isVisible()){return";COUNT="+e.getValue()}return""},setValue:function(f){var g=false,e=Ext.isArray(f)?f:f.split(";");Ext.each(e,function(a){if(a.indexOf("COUNT")>-1){var b=a.split("=")[1];Ext.getCmp(this.id+"-combo").setValue("for");Ext.getCmp(this.id+"-num").setValue(b).show();Ext.getCmp(this.id+"-endlabel").show()}else{if(a.indexOf("UNTIL")>-1){var c=a.split("=")[1];Ext.getCmp(this.id+"-combo").setValue("until");Ext.getCmp(this.id+"-date").setValue(Date.parseDate(c,this.untilDateFormat)).show();Ext.getCmp(this.id+"-endlabel").hide()}}},this);return this}});return[this.repeatEvery,this.weekly,this.monthly,this.yearly,this.until]}});Ext.reg("extensible.recurrencefield",Ext.ensible.cal.RecurrenceField);Ext.ensible.cal.DateRangeField=Ext.extend(Ext.form.Field,{toText:"to",allDayText:"All day",singleLine:"auto",singleLineMinWidth:490,dateFormat:"n/j/Y",timeFormat:Ext.ensible.Date.use24HourTime?"G:i":"g:i A",onRender:function(k,g){if(!this.el){this.startDate=new Ext.form.DateField({id:this.id+"-start-date",format:this.dateFormat,width:100,listeners:{change:{fn:function(){this.onFieldChange("date","start")},scope:this}}});this.startTime=new Ext.form.TimeField({id:this.id+"-start-time",hidden:this.showTimes===false,labelWidth:0,hideLabel:true,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","start")},scope:this}}});this.endTime=new Ext.form.TimeField({id:this.id+"-end-time",hidden:this.showTimes===false,labelWidth:0,hideLabel:true,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","end")},scope:this}}});this.endDate=new Ext.form.DateField({id:this.id+"-end-date",format:this.dateFormat,hideLabel:true,width:100,listeners:{change:{fn:function(){this.onFieldChange("date","end")},scope:this}}});this.allDay=new Ext.form.Checkbox({id:this.id+"-allday",hidden:this.showTimes===false||this.showAllDay===false,boxLabel:this.allDayText,handler:function(b,a){this.startTime.setVisible(!a);this.endTime.setVisible(!a)},scope:this});this.toLabel=new Ext.form.Label({xtype:"label",id:this.id+"-to-label",text:this.toText});var h=this.singleLine;if(h=="auto"){var i,l=this.ownerCt.getWidth()-this.ownerCt.getEl().getPadding("lr");if(i=this.ownerCt.getEl().child(".x-panel-body")){l-=i.getPadding("lr")}if(i=this.ownerCt.getEl().child(".x-form-item-label")){l-=i.getWidth()-i.getPadding("lr")}h=l<=this.singleLineMinWidth?false:true}this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:k,layout:"table",layoutConfig:{columns:h?6:3},defaults:{hideParent:true},items:[this.startDate,this.startTime,this.toLabel,h?this.endTime:this.endDate,h?this.endDate:this.endTime,this.allDay]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll([this.startDate,this.endDate,this.toLabel,this.startTime,this.endTime,this.allDay])}Ext.ensible.cal.DateRangeField.superclass.onRender.call(this,k,g);if(!h){this.el.child("tr").addClass("ext-dt-range-row1")}},onFieldChange:function(e,c){this.checkDates(e,c);this.fireEvent("change",this,this.getValue())},checkDates:function(l,k){var m=Ext.getCmp(this.id+"-start-"+l),h=Ext.getCmp(this.id+"-end-"+l),n=this.getDT("start"),i=this.getDT("end");if(n>i){if(k=="start"){h.setValue(n)}else{m.setValue(i);this.checkDates(l,"start")}}if(l=="date"){this.checkDates("time",k)}},getValue:function(){return[this.getDT("start"),this.getDT("end"),this.allDay.getValue()]},getDT:function(g){var e=this[g+"Time"].getValue(),f=this[g+"Date"].getValue();if(Ext.isDate(f)){f=f.format(this[g+"Date"].format)}else{return null}if(e!=""){return Date.parseDate(f+" "+e,this[g+"Date"].format+" "+this[g+"Time"].format)}return Date.parseDate(f,this[g+"Date"].format)},setValue:function(b){if(Ext.isArray(b)){this.setDT(b[0],"start");this.setDT(b[1],"end");this.allDay.setValue(!!b[2])}else{if(Ext.isDate(b)){this.setDT(b,"start");this.setDT(b,"end");this.allDay.setValue(false)}else{if(b[Ext.ensible.cal.EventMappings.StartDate.name]){this.setDT(b[Ext.ensible.cal.EventMappings.StartDate.name],"start");if(!this.setDT(b[Ext.ensible.cal.EventMappings.EndDate.name],"end")){this.setDT(b[Ext.ensible.cal.EventMappings.StartDate.name],"end")}this.allDay.setValue(!!b[Ext.ensible.cal.EventMappings.IsAllDay.name])}}}},setDT:function(e,c){if(e&&Ext.isDate(e)){this[c+"Date"].setValue(e);this[c+"Time"].setValue(e.format(this[c+"Time"].format));return true}},isDirty:function(){var b=false;if(this.rendered&&!this.disabled){this.items.each(function(a){if(a.isDirty()){b=true;return false}})}return b},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(b){this.items.each(function(a){if(a[b]){a[b]()}})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.ensible.cal.DateRangeField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("extensible.daterangefield",Ext.ensible.cal.DateRangeField);Ext.ensible.cal.ReminderField=Ext.extend(Ext.form.ComboBox,{width:200,fieldLabel:"Reminder",mode:"local",triggerAction:"all",forceSelection:true,displayField:"desc",valueField:"value",noneText:"None",atStartTimeText:"At start time",reminderValueFormat:"{0} {1} before start",minutesText:"minutes",hourText:"hour",hoursText:"hours",dayText:"day",daysText:"days",weekText:"week",weeksText:"weeks",getValueList:function(){var g=this,f=g.reminderValueFormat,e=String.format;return[["",g.noneText],["0",g.atStartTimeText],["5",e(f,"5",g.getMinutesText(5))],["15",e(f,"15",g.getMinutesText(15))],["30",e(f,"30",g.getMinutesText(30))],["60",e(f,"1",g.getHoursText(1))],["90",e(f,"1.5",g.getHoursText(1.5))],["120",e(f,"2",g.getHoursText(2))],["180",e(f,"3",g.getHoursText(3))],["360",e(f,"6",g.getHoursText(6))],["720",e(f,"12",g.getHoursText(12))],["1440",e(f,"1",g.getDaysText(1))],["2880",e(f,"2",g.getDaysText(2))],["4320",e(f,"3",g.getDaysText(3))],["5760",e(f,"4",g.getDaysText(4))],["7200",e(f,"5",g.getDaysText(5))],["10080",e(f,"1",g.getWeeksText(1))],["20160",e(f,"2",g.getWeeksText(2))]]},getMinutesText:function(b){return b===1?this.minuteText:this.minutesText},getHoursText:function(b){return b===1?this.hourText:this.hoursText},getDaysText:function(b){return b===1?this.dayText:this.daysText},getWeeksText:function(b){return b===1?this.weekText:this.weeksText},initComponent:function(){Ext.ensible.cal.ReminderField.superclass.initComponent.call(this);this.store=this.store||new Ext.data.ArrayStore({fields:[this.valueField,this.displayField],idIndex:0,data:this.getValueList()})},initValue:function(){if(this.value!==undefined){this.setValue(this.value)}else{this.setValue("")}this.originalValue=this.getValue()}});Ext.reg("extensible.reminderfield",Ext.ensible.cal.ReminderField);Ext.ensible.cal.ColorPalette=Ext.extend(Ext.ColorPalette,{colorCount:32,initComponent:function(){Ext.ensible.cal.ColorPalette.superclass.initComponent.call(this);this.addClass("x-calendar-palette");this.tpl=new Ext.XTemplate('<tpl for="."><a class="x-unselectable x-cal-color" id="'+this.id+'-color-{.}" href="#" hidefocus="on"><em><span class="x-cal-{.}">&#160;</span></em></a></tpl>');if(this.handler){this.on("select",this.handler,this.scope||this)}this.colors=[];for(var b=1;b<=this.colorCount;b++){this.colors.push(b)}},handleClick:function(i,g){i.preventDefault();var e=i.getTarget(".x-cal-color",3,true);if(e){var h=e.id.split("-color-")[1];this.select(h)}},select:function(c,e){if(c!=this.value){if(this.value){Ext.fly(this.id+"-color-"+this.value).removeClass("x-color-palette-sel")}Ext.get(this.id+"-color-"+c).addClass("x-color-palette-sel");this.value=c;if(e!==true){this.fireEvent("select",this,c)}}}});Ext.reg("extensible.calendarcolorpalette",Ext.ensible.cal.ColorPalette);Ext.ensible.cal.CalendarListMenu=Ext.extend(Ext.menu.Menu,{hideOnClick:true,ignoreParentClicks:true,cls:"x-calendar-list-menu",displayOnlyThisCalendarText:"Display only this calendar",enableScrolling:false,initComponent:function(){this.addEvents("showcalendar","hidecalendar","radiocalendar","colorchange");Ext.apply(this,{items:[{text:this.displayOnlyThisCalendarText,iconCls:"extensible-cal-icon-cal-show",handler:this.handleRadioCalendarClick.createDelegate(this)},"-",{xtype:"extensible.calendarcolorpalette",handler:this.handleColorSelect.createDelegate(this)}]});Ext.ensible.cal.CalendarListMenu.superclass.initComponent.call(this)},afterRender:function(){Ext.ensible.cal.CalendarListMenu.superclass.afterRender.call(this);this.palette=this.findByType("extensible.calendarcolorpalette")[0];if(this.colorId){this.palette.select(this.colorId,true)}},handleRadioCalendarClick:function(c,e){this.fireEvent("radiocalendar",this,this.calendarId)},handleColorSelect:function(c,e){this.fireEvent("colorchange",this,this.calendarId,e,this.colorId);this.colorId=e;this.menuHide()},setCalendar:function(c,e){this.calendarId=c;this.colorId=e;if(this.rendered){this.palette.select(e,true)}return this},menuHide:function(){if(this.hideOnClick){this.hide(true)}}});Ext.reg("extensible.calendarlistmenu",Ext.ensible.cal.CalendarListMenu);Ext.ensible.cal.EventContextMenu=Ext.extend(Ext.menu.Menu,{hideOnClick:true,ignoreParentClicks:true,editDetailsText:"Edit Details",deleteText:"Delete",moveToText:"Move to...",enableScrolling:false,initComponent:function(){this.addEvents("editdetails","eventdelete","eventmove");this.buildMenu();Ext.ensible.cal.CalendarListMenu.superclass.initComponent.call(this)},buildMenu:function(){if(this.rendered){return}this.dateMenu=new Ext.menu.DateMenu({scope:this,handler:function(c,e){e=Ext.ensible.Date.copyTime(this.rec.data[Ext.ensible.cal.EventMappings.StartDate.name],e);this.fireEvent("eventmove",this,this.rec,e)}});Ext.apply(this,{items:[{text:this.editDetailsText,iconCls:"extensible-cal-icon-evt-edit",scope:this,handler:function(){this.fireEvent("editdetails",this,this.rec,this.ctxEl)}},{text:this.deleteText,iconCls:"extensible-cal-icon-evt-del",scope:this,handler:function(){this.fireEvent("eventdelete",this,this.rec,this.ctxEl)}},"-",{text:this.moveToText,iconCls:"extensible-cal-icon-evt-move",menu:this.dateMenu}]})},showForEvent:function(g,f,e){this.rec=g;this.ctxEl=f;this.dateMenu.picker.setValue(g.data[Ext.ensible.cal.EventMappings.StartDate.name]);this.showAt(e)},onHide:function(){Ext.ensible.cal.CalendarListMenu.superclass.onHide.call(this);delete this.ctxEl}});Ext.reg("extensible.eventcontextmenu",Ext.ensible.cal.EventContextMenu);Ext.ensible.cal.CalendarList=Ext.extend(Ext.Panel,{title:"Calendars",collapsible:true,autoHeight:true,layout:"fit",menuSelector:"em",width:100,initComponent:function(){this.addClass("x-calendar-list");Ext.ensible.cal.CalendarList.superclass.initComponent.call(this)},afterRender:function(c,e){Ext.ensible.cal.CalendarList.superclass.afterRender.call(this);if(this.store){this.setStore(this.store,true)}this.refresh();this.body.on("click",this.onClick,this);this.body.on("mouseover",this.onMouseOver,this,{delegate:"li"});this.body.on("mouseout",this.onMouseOut,this,{delegate:"li"})},getListTemplate:function(){if(!this.tpl){this.tpl=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evr {colorCls} {hiddenCls}">{title}<em>&#160;</em></li>',"</tpl></ul>"):new Ext.XTemplate('<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evo {colorCls} {hiddenCls}">','<div class="ext-cal-evm">','<div class="ext-cal-evi">{title}<em>&#160;</em></div>',"</div>","</li>","</tpl></ul>");this.tpl.compile()}return this.tpl},setStore:function(e,c){if(!c&&this.store){this.store.un("load",this.refresh,this);this.store.un("add",this.refresh,this);this.store.un("remove",this.refresh,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.refresh,this)}if(e){e.on("load",this.refresh,this);e.on("add",this.refresh,this);e.on("remove",this.refresh,this);e.on("update",this.onUpdate,this);e.on("clear",this.refresh,this)}this.store=e},onUpdate:function(e,g,f){if(f==Ext.data.Record.COMMIT){this.refresh()}},refresh:function(){if(this.skipRefresh){return}var l=[],n=0,k=null,h=Ext.ensible.cal.CalendarMappings,m=this.store.getRange(),i=m.length;for(;n<i;n++){k={cmpId:this.id+"__"+m[n].data[h.CalendarId.name],title:m[n].data[h.Title.name],colorCls:this.getColorCls(m[n].data[h.ColorId.name])};if(m[n].data[h.IsHidden.name]===true){k.hiddenCls="ext-cal-hidden"}l[l.length]=k}this.getListTemplate().overwrite(this.body,l)},getColorCls:function(b){return"x-cal-"+b+"-ad"},toggleCalendar:function(i,k){var l=this.store.getById(i),h=Ext.ensible.cal.CalendarMappings,g=l.data[h.IsHidden.name];l.set([h.IsHidden.name],!g);if(k!==false){l.commit()}},showCalendar:function(g,e){var f=this.store.getById(g);if(f.data[Ext.ensible.cal.CalendarMappings.IsHidden.name]===true){this.toggleCalendar(g,e)}},hideCalendar:function(g,e){var f=this.store.getById(g);if(f.data[Ext.ensible.cal.CalendarMappings.IsHidden.name]!==true){this.toggleCalendar(g,e)}},radioCalendar:function(k){var h=0,l,n=Ext.ensible.cal.CalendarMappings.CalendarId.name,m=this.store.getRange(),i=m.length;for(;h<i;h++){l=m[h].data[n];if(l==k){this.showCalendar(l,false)}else{this.hideCalendar(l,false)}}this.skipRefresh=true;this.store.commitChanges();delete this.skipRefresh;this.refresh()},onMouseOver:function(c,e){Ext.fly(e).addClass("hover")},onMouseOut:function(c,e){Ext.fly(e).removeClass("hover")},getCalendarId:function(b){return b.id.split("__")[1]},getCalendarItemEl:function(b){return Ext.get(this.id+"__"+b)},onClick:function(g,f){var e;if(e=g.getTarget(this.menuSelector,3,true)){this.showEventMenu(e,g.getXY())}else{if(e=g.getTarget("li",3,true)){this.toggleCalendar(this.getCalendarId(e))}}},handleColorChange:function(k,i,l,h){var g=this.store.getById(i);g.data[Ext.ensible.cal.CalendarMappings.ColorId.name]=l;g.commit()},handleRadioCalendar:function(e,c){this.radioCalendar(c)},showEventMenu:function(h,g){var i=this.getCalendarId(h.parent("li")),k=this.store.getById(i),l=k.data[Ext.ensible.cal.CalendarMappings.ColorId.name];if(!this.menu){this.menu=new Ext.ensible.cal.CalendarListMenu();this.menu.on("colorchange",this.handleColorChange,this);this.menu.on("radiocalendar",this.handleRadioCalendar,this)}this.menu.setCalendar(i,l);this.menu.showAt(g)}});Ext.reg("extensible.calendarlist",Ext.ensible.cal.CalendarList);Ext.ensible.cal.EventEditForm=Ext.extend(Ext.form.FormPanel,{labelWidth:65,labelWidthRightCol:65,colWidthLeft:0.6,colWidthRight:0.4,title:"Event Form",titleTextAdd:"Add Event",titleTextEdit:"Edit Event",titleLabelText:"Title",datesLabelText:"When",reminderLabelText:"Reminder",notesLabelText:"Notes",locationLabelText:"Location",webLinkLabelText:"Web Link",calendarLabelText:"Calendar",repeatsLabelText:"Repeats",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",bodyStyle:"padding:20px 20px 10px;",border:false,buttonAlign:"center",autoHeight:true,enableRecurrence:false,layout:"column",cls:"ext-evt-edit-form",initComponent:function(){this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true});this.titleField=new Ext.form.TextField({fieldLabel:this.titleLabelText,name:Ext.ensible.cal.EventMappings.Title.name,anchor:"90%"});this.dateRangeField=new Ext.ensible.cal.DateRangeField({fieldLabel:this.datesLabelText,singleLine:false,anchor:"90%",listeners:{change:this.onDateChange.createDelegate(this)}});this.reminderField=new Ext.ensible.cal.ReminderField({name:Ext.ensible.cal.EventMappings.Reminder.name,fieldLabel:this.reminderLabelText});this.notesField=new Ext.form.TextArea({fieldLabel:this.notesLabelText,name:Ext.ensible.cal.EventMappings.Notes.name,grow:true,growMax:150,anchor:"100%"});this.locationField=new Ext.form.TextField({fieldLabel:this.locationLabelText,name:Ext.ensible.cal.EventMappings.Location.name,anchor:"100%"});this.urlField=new Ext.form.TextField({fieldLabel:this.webLinkLabelText,name:Ext.ensible.cal.EventMappings.Url.name,anchor:"100%"});var e=[this.titleField,this.dateRangeField,this.reminderField],c=[this.notesField,this.locationField,this.urlField];if(this.enableRecurrence){this.recurrenceField=new Ext.ensible.cal.RecurrenceField({name:Ext.ensible.cal.EventMappings.RRule.name,fieldLabel:this.repeatsLabelText,anchor:"100%"});e.splice(2,0,this.recurrenceField)}if(this.calendarStore){this.calendarField=new Ext.ensible.cal.CalendarCombo({store:this.calendarStore,fieldLabel:this.calendarLabelText,name:Ext.ensible.cal.EventMappings.CalendarId.name});e.splice(2,0,this.calendarField)}this.items=[{id:this.id+"-left-col",columnWidth:this.colWidthLeft,layout:"form",border:false,items:e},{id:this.id+"-right-col",columnWidth:this.colWidthRight,layout:"form",labelWidth:this.labelWidthRightCol||this.labelWidth,border:false,items:c}];this.fbar=[{text:this.saveButtonText,scope:this,handler:this.onSave},{cls:"ext-del-btn",text:this.deleteButtonText,scope:this,handler:this.onDelete},{text:this.cancelButtonText,scope:this,handler:this.onCancel}];Ext.ensible.cal.EventEditForm.superclass.initComponent.call(this)},onDateChange:function(e,c){if(this.recurrenceField){this.recurrenceField.setStartDate(c[0])}},loadRecord:function(b){this.form.reset().loadRecord.apply(this.form,arguments);this.activeRecord=b;this.dateRangeField.setValue(b.data);if(this.recurrenceField){this.recurrenceField.setStartDate(b.data[Ext.ensible.cal.EventMappings.StartDate.name])}if(this.calendarStore){this.form.setValues({calendar:b.data[Ext.ensible.cal.EventMappings.CalendarId.name]})}if(b.phantom){this.setTitle(this.titleTextAdd);Ext.select(".ext-del-btn").setDisplayed(false)}else{this.setTitle(this.titleTextEdit);Ext.select(".ext-del-btn").setDisplayed(true)}this.titleField.focus()},updateRecord:function(){var l=this.dateRangeField.getValue(),i=Ext.ensible.cal.EventMappings,k=this.activeRecord,h=k.fields,g=false;k.beginEdit();h.each(function(b){var a=this.form.findField(b.name);if(a){var c=a.getValue();if(c.getGroupValue){c=c.getGroupValue()}else{if(a.eachItem){c=[];a.eachItem(function(e){c.push(e.getValue())})}}k.set(b.name,c)}},this);k.set(i.StartDate.name,l[0]);k.set(i.EndDate.name,l[1]);k.set(i.IsAllDay.name,l[2]);g=k.dirty;k.endEdit();return g},onCancel:function(){this.cleanup(true);this.fireEvent("eventcancel",this,this.activeRecord)},cleanup:function(b){if(this.activeRecord){this.activeRecord.reject()}delete this.activeRecord;if(this.form.isDirty()){this.form.reset()}},onSave:function(){if(!this.form.isValid()){return}if(!this.updateRecord()){this.onCancel();return}this.fireEvent(this.activeRecord.phantom?"eventadd":"eventupdate",this,this.activeRecord)},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}});Ext.reg("extensible.eventeditform",Ext.ensible.cal.EventEditForm);Ext.ensible.cal.EventEditWindow=Ext.extend(Ext.Window,{titleTextAdd:"Add Event",titleTextEdit:"Edit Event",width:600,border:true,closeAction:"hide",modal:false,resizable:false,buttonAlign:"left",labelWidth:65,detailsLinkText:"Edit Details...",savingMessage:"Saving changes...",deletingMessage:"Deleting event...",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",titleLabelText:"Title",datesLabelText:"When",calendarLabelText:"Calendar",editDetailsLinkClass:"edit-dtl-link",bodyStyle:"padding:5px 10px;",enableEditDetails:true,initComponent:function(){this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true,editdetails:true});this.fbar=["->",{text:this.saveButtonText,disabled:false,handler:this.onSave,scope:this},{id:this.id+"-delete-btn",text:this.deleteButtonText,disabled:false,handler:this.onDelete,scope:this,hideMode:"offsets"},{text:this.cancelButtonText,disabled:false,handler:this.onCancel,scope:this}];if(this.enableEditDetails!==false){this.fbar.unshift({xtype:"tbtext",text:'<a href="#" class="'+this.editDetailsLinkClass+'">'+this.detailsLinkText+"</a>"})}Ext.ensible.cal.EventEditWindow.superclass.initComponent.call(this)},onRender:function(g,f){this.deleteBtn=Ext.getCmp(this.id+"-delete-btn");this.titleField=new Ext.form.TextField({name:Ext.ensible.cal.EventMappings.Title.name,fieldLabel:this.titleLabelText,anchor:"100%"});this.dateRangeField=new Ext.ensible.cal.DateRangeField({anchor:"95%",fieldLabel:this.datesLabelText});var e=[this.titleField,this.dateRangeField];if(this.calendarStore){this.calendarField=new Ext.ensible.cal.CalendarCombo({name:Ext.ensible.cal.EventMappings.CalendarId.name,anchor:"100%",fieldLabel:this.calendarLabelText,store:this.calendarStore});e.push(this.calendarField)}this.formPanel=new Ext.FormPanel({labelWidth:this.labelWidth,frame:false,bodyBorder:false,border:false,items:e});this.add(this.formPanel);Ext.ensible.cal.EventEditWindow.superclass.onRender.call(this,g,f)},afterRender:function(){Ext.ensible.cal.EventEditWindow.superclass.afterRender.call(this);this.el.addClass("ext-cal-event-win");this.el.select("."+this.editDetailsLinkClass).on("click",this.onEditDetailsClick,this)},onEditDetailsClick:function(b){b.stopEvent();this.updateRecord(true);this.fireEvent("editdetails",this,this.activeRecord,this.animateTarget)},show:function(o,p){var r=(Ext.isIE8&&Ext.isStrict)?null:p,m=Ext.ensible.cal.EventMappings;Ext.ensible.cal.EventEditWindow.superclass.show.call(this,r,function(){this.titleField.focus(false,100)});this.deleteBtn[o.data&&o.data[m.EventId.name]?"show":"hide"]();var q,f=this.formPanel.form;if(o.data){q=o;if(q.phantom){this.setTitle(this.titleTextAdd)}else{this.setTitle(this.titleTextEdit)}f.loadRecord(q)}else{this.setTitle(this.titleTextAdd);var n=o[m.StartDate.name],l=o[m.EndDate.name]||n.add("h",1);q=new Ext.ensible.cal.EventRecord();q.data[m.StartDate.name]=n;q.data[m.EndDate.name]=l;q.data[m.IsAllDay.name]=!!o[m.IsAllDay.name]||n.getDate()!=l.clone().add(Date.MILLI,1).getDate();f.reset();f.loadRecord(q)}if(this.calendarStore){this.calendarField.setValue(q.data[m.CalendarId.name])}this.dateRangeField.setValue(q.data);this.activeRecord=q;this.el.setStyle("z-index",12000);return this},roundTime:function(e,g){g=g||15;var f=parseInt(e.getMinutes());return e.add("mi",g-(f%g))},onCancel:function(){this.cleanup(true);this.fireEvent("eventcancel",this,this.animateTarget)},cleanup:function(b){if(this.activeRecord){this.activeRecord.reject()}delete this.activeRecord;if(b===true){this.hide()}},updateRecord:function(o){var n=this.dateRangeField.getValue(),l=Ext.ensible.cal.EventMappings,m=this.activeRecord,p=this.formPanel.form,k=m.fields,i=false;m.beginEdit();k.each(function(b){var a=p.findField(b.name);if(a){var c=a.getValue();if(c.getGroupValue){c=c.getGroupValue()}else{if(a.eachItem){c=[];a.eachItem(function(e){c.push(e.getValue())})}}m.set(b.name,c)}},this);m.set(l.StartDate.name,n[0]);m.set(l.EndDate.name,n[1]);m.set(l.IsAllDay.name,n[2]);i=m.dirty;if(!o){m.endEdit()}return i},onSave:function(){if(!this.formPanel.form.isValid()){return}if(!this.updateRecord()){this.onCancel();return}this.fireEvent(this.activeRecord.phantom?"eventadd":"eventupdate",this,this.activeRecord,this.animateTarget)},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord,this.animateTarget)}});Ext.reg("extensible.eventeditwindow",Ext.ensible.cal.EventEditWindow);Ext.ensible.cal.CalendarView=Ext.extend(Ext.BoxComponent,{startDay:0,spansHavePriority:false,trackMouseOver:true,enableFx:true,enableAddFx:true,enableUpdateFx:false,enableRemoveFx:true,enableDD:true,enableContextMenus:true,suppressBrowserContextMenu:false,monitorResize:true,todayText:"Today",ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",ddResizeEventText:"Update event to {0}",defaultEventTitleText:"(No title)",dateParamStart:"start",dateParamEnd:"end",dateParamFormat:"Y-m-d",editModal:false,enableEditDetails:true,weekendCls:"ext-cal-day-we",prevMonthCls:"ext-cal-day-prev",nextMonthCls:"ext-cal-day-next",todayCls:"ext-cal-day-today",hideMode:"offsets",weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",getEventBodyMarkup:Ext.emptyFn,getEventTemplate:Ext.emptyFn,initComponent:function(){this.setStartDate(this.startDate||new Date());Ext.ensible.cal.CalendarView.superclass.initComponent.call(this);if(this.readOnly===true){this.addClass("ext-cal-readonly")}this.addEvents({eventsrendered:true,eventclick:true,eventover:true,eventout:true,beforedatechange:true,datechange:true,rangeselect:true,beforeeventmove:true,eventmove:true,initdrag:true,dayover:true,dayout:true,editdetails:true,eventadd:true,eventupdate:true,eventcancel:true,beforeeventdelete:true,eventdelete:true})},afterRender:function(){Ext.ensible.cal.CalendarView.superclass.afterRender.call(this);this.renderTemplate();if(this.store){this.setStore(this.store,true);if(this.store.deferLoad){this.reloadStore(this.store.deferLoad);delete this.store.deferLoad}else{this.store.initialParams=this.getStoreParams()}}if(this.calendarStore){this.setCalendarStore(this.calendarStore,true)}this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,click:this.onClick,resize:this.onResize,scope:this});if(this.enableContextMenus&&this.readOnly!==true){this.el.on("contextmenu",this.onContextMenu,this)}this.el.unselectable();if(this.enableDD&&this.readOnly!==true&&this.initDD){this.initDD()}this.on("eventsrendered",this.onEventsRendered,this);this.forceSize.defer(100,this)},getStoreDateParams:function(){var b={};b[this.dateParamStart]=this.viewStart.format(this.dateParamFormat);b[this.dateParamEnd]=this.viewEnd.format(this.dateParamFormat);return b},getStoreParams:function(){var b=this.getStoreDateParams();return b},reloadStore:function(b){Ext.ensible.log("reloadStore");b=Ext.isObject(b)?b:{};b.params=b.params||{};Ext.apply(b.params,this.getStoreParams());this.store.load(b)},onEventsRendered:function(){this.forceSize()},forceSize:function(){if(this.el&&this.el.child){var g=this.el.child(".ext-cal-hd-ct"),f=this.el.child(".ext-cal-body-ct"),e=this.el.parent();if(g&&f){f.setHeight(e.getHeight()-g.getHeight())}}},refresh:function(b){Ext.ensible.log("refresh (base), reload = "+b);if(b===true){this.reloadStore()}this.prepareData();this.renderTemplate();this.renderItems()},getWeekCount:function(){var b=Ext.ensible.Date.diffDays(this.viewStart,this.viewEnd);return Math.ceil(b/this.dayCount)},prepareData:function(){var l=this.startDate.getLastDateOfMonth(),p=0,m=0,n=this.viewStart.clone(),o=this.weekCount<1?6:this.weekCount;this.eventGrid=[[]];this.allDayGrid=[[]];this.evtMaxCount=[];var i=this.store.queryBy(function(a){return this.isEventVisible(a.data)},this);for(;p<o;p++){this.evtMaxCount[p]=0;if(this.weekCount==-1&&n>l){break}this.eventGrid[p]=this.eventGrid[p]||[];this.allDayGrid[p]=this.allDayGrid[p]||[];for(d=0;d<this.dayCount;d++){if(i.getCount()>0){var k=i.filterBy(function(a){var b=(n.getTime()==a.data[Ext.ensible.cal.EventMappings.StartDate.name].clearTime(true).getTime());var c=(p==0&&d==0&&(n>a.data[Ext.ensible.cal.EventMappings.StartDate.name]));return b||c},this);this.sortEventRecordsForDay(k);this.prepareEventGrid(k,p,d)}n=n.add(Date.DAY,1)}}this.currentWeekCount=p},prepareEventGrid:function(r,k,m){var o=this,n=0,p=o.viewStart.clone(),l=o.maxEventsPerDay||999,q;r.each(function(b){var a=Ext.ensible.cal.EventMappings;if(Ext.ensible.Date.diffDays(b.data[a.StartDate.name],b.data[a.EndDate.name])>0){var c=Ext.ensible.Date.diffDays(Ext.ensible.Date.max(o.viewStart,b.data[a.StartDate.name]),Ext.ensible.Date.min(o.viewEnd,b.data[a.EndDate.name]))+1;o.prepareEventGridSpans(b,o.eventGrid,k,m,c);o.prepareEventGridSpans(b,o.allDayGrid,k,m,c,true)}else{n=o.findEmptyRowIndex(k,m);o.eventGrid[k][m]=o.eventGrid[k][m]||[];o.eventGrid[k][m][n]=b;if(b.data[a.IsAllDay.name]){n=o.findEmptyRowIndex(k,m,true);o.allDayGrid[k][m]=o.allDayGrid[k][m]||[];o.allDayGrid[k][m][n]=b}}q=o[o.isHeaderView?"allDayGrid":"eventGrid"][k][m]||[];if(q.length&&o.evtMaxCount[k]<q.length){o.evtMaxCount[k]=Math.min(l+1,q.length)}return true},o)},prepareEventGridSpans:function(q,x,r,s,p,o){var t=r,w=s,n=this.findEmptyRowIndex(r,s,o),u=this.viewStart.clone();var v={event:q,isSpan:true,isSpanStart:true,spanLeft:false,spanRight:(s==6)};x[r][s]=x[r][s]||[];x[r][s][n]=v;while(--p){u=u.add(Date.DAY,1);if(u>this.viewEnd){break}if(++w>6){w=0;t++;n=this.findEmptyRowIndex(t,0)}x[t]=x[t]||[];x[t][w]=x[t][w]||[];x[t][w][n]={event:q,isSpan:true,isSpanStart:(w==0),spanLeft:(t>r)&&(w%7==0),spanRight:(w==6)&&(p>1)}}},findEmptyRowIndex:function(i,l,k){var n=k?this.allDayGrid:this.eventGrid,p=n[i]?n[i][l]||[]:[],o=0,m=p.length;for(;o<m;o++){if(p[o]==null){return o}}return m},renderTemplate:function(){if(this.tpl){this.tpl.overwrite(this.el,this.getTemplateParams());this.lastRenderStart=this.viewStart.clone();this.lastRenderEnd=this.viewEnd.clone()}},getTemplateParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,weekendCls:this.weekendCls,prevMonthCls:this.prevMonthCls,nextMonthCls:this.nextMonthCls,todayCls:this.todayCls}},disableStoreEvents:function(){this.monitorStoreEvents=false;return this},enableStoreEvents:function(b){this.monitorStoreEvents=true;if(b===true){this.refresh()}return this},onResize:function(){this.refresh(false)},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(c,e){this.moveEvent(c,e)},onCalendarEndDrag:function(h,g,i){this.dragPending=true;var f={},i=this.onCalendarEndDragComplete.createDelegate(this,[i]);f[Ext.ensible.cal.EventMappings.StartDate.name]=h;f[Ext.ensible.cal.EventMappings.EndDate.name]=g;if(this.fireEvent("rangeselect",this,f,i)!==false){this.showEventEditor(f,null);this.editWin.on("hide",i,this,{single:true})}else{this.onCalendarEndDragComplete(i)}},onCalendarEndDragComplete:function(b){b();this.dragPending=false},onUpdate:function(f,i,g){if(this.hidden===true||this.monitorStoreEvents===false){return}if(g==Ext.data.Record.COMMIT){Ext.ensible.log("onUpdate");this.dismissEventEditor();var h=i.data[Ext.ensible.cal.EventMappings.RRule.name];this.refresh(h!==undefined&&h!=="");if(this.enableFx&&this.enableUpdateFx){this.doUpdateFx(this.getEventEls(i.data[Ext.ensible.cal.EventMappings.EventId.name]),{scope:this})}}},doUpdateFx:function(e,c){this.highlightEvent(e,null,c)},onAdd:function(l,g,h){var k=Ext.isArray(g)?g[0]:g;if(this.hidden===true||this.monitorStoreEvents===false||k.phantom){return}if(k._deleting){delete k._deleting;return}Ext.ensible.log("onAdd");var i=k.data[Ext.ensible.cal.EventMappings.RRule.name];this.dismissEventEditor();this.tempEventId=k.id;this.refresh(i!==undefined&&i!=="");if(this.enableFx&&this.enableAddFx){this.doAddFx(this.getEventEls(k.data[Ext.ensible.cal.EventMappings.EventId.name]),{scope:this})}},doAddFx:function(e,c){e.fadeIn(Ext.apply(c,{duration:2}))},onRemove:function(f,i){if(this.hidden===true||this.monitorStoreEvents===false){return}Ext.ensible.log("onRemove");this.dismissEventEditor();var h=i.data[Ext.ensible.cal.EventMappings.RRule.name],g=h!==undefined&&h!=="";if(this.enableFx&&this.enableRemoveFx){this.doRemoveFx(this.getEventEls(i.data[Ext.ensible.cal.EventMappings.EventId.name]),{remove:true,scope:this,callback:this.refresh.createDelegate(this,[g])})}else{this.getEventEls(i.data[Ext.ensible.cal.EventMappings.EventId.name]).remove();this.refresh(g)}},doRemoveFx:function(e,c){if(e.getCount()==0&&Ext.isFunction(c.callback)){c.callback.call(c.scope||this)}else{e.fadeOut(c)}},highlightEvent:function(c,g,i){if(this.enableFx){var h;!(Ext.isIE||Ext.isOpera)?c.highlight(g,i):c.each(function(a){a.highlight(g,Ext.applyIf({attr:"color"},i));if(h=a.child(".ext-cal-evm")){h.highlight(g,i)}},this)}},getEventIdFromEl:function(l){l=Ext.get(l);var k,i="",h,g=l.dom.className.split(" ");Ext.each(g,function(a){k=a.split(this.eventElIdDelimiter);if(k.length>1){i=k[1];return false}},this);return i},getEventId:function(b){if(b===undefined&&this.tempEventId){b=this.tempEventId}return b},getEventSelectorCls:function(e,f){var g=f?".":"";return g+this.id+this.eventElIdDelimiter+this.getEventId(e)},getEventEls:function(c){var e=this.el.select(this.getEventSelectorCls(this.getEventId(c),true),false);return new Ext.CompositeElement(e)},isToday:function(){var b=new Date().clearTime().getTime();return this.viewStart.getTime()<=b&&this.viewEnd.getTime()>=b},onDataChanged:function(b){Ext.ensible.log("onDataChanged");this.refresh(false)},isEventVisible:function(m){var p=Ext.ensible.cal.EventMappings,q=m.data?m.data:m,n=q[p.CalendarId.name],s=this.calendarStore?this.calendarStore.getById(n):null;if(s&&s.data[Ext.ensible.cal.CalendarMappings.IsHidden.name]===true){return false}var t=this.viewStart.getTime(),r=this.viewEnd.getTime(),l=q[p.StartDate.name].getTime(),o=q[p.EndDate.name].getTime();return Ext.ensible.Date.rangesOverlap(t,r,l,o)},isOverlapping:function(r,s){var t=r.data?r.data:r,u=s.data?s.data:s,x=Ext.ensible.cal.EventMappings,z=t[x.StartDate.name].getTime(),w=t[x.EndDate.name].add(Date.SECOND,-1).getTime(),A=u[x.StartDate.name].getTime(),y=u[x.EndDate.name].add(Date.SECOND,-1).getTime(),v=Ext.ensible.Date.diff(t[x.StartDate.name],u[x.StartDate.name],"m");if(w<z){w=z}if(y<A){y=A}var p=Ext.ensible.Date.rangesOverlap(z,w,A,y),q=this.minEventDisplayMinutes||0,B=q>0&&(v>-q&&v<q);return(p||B)},getDayEl:function(b){return Ext.get(this.getDayId(b))},getDayId:function(b){if(Ext.isDate(b)){b=b.format("Ymd")}return this.id+this.dayElIdDelimiter+b},getStartDate:function(){return this.startDate},setStartDate:function(c,e){Ext.ensible.log("setStartDate (base) "+c.format("Y-m-d"));if(this.fireEvent("beforedatechange",this,this.startDate,c,this.viewStart,this.viewEnd)!==false){this.startDate=c.clearTime();this.setViewBounds(c);if(this.rendered){this.refresh(e)}this.fireEvent("datechange",this,this.startDate,this.viewStart,this.viewEnd)}},setViewBounds:function(g){var h=g||this.startDate,i=h.getDay()-this.startDay;if(i<0){i+=7}switch(this.weekCount){case 0:case 1:this.viewStart=this.dayCount<7&&!this.startDayIsStatic?h:h.add(Date.DAY,-i).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.dayCount||7).add(Date.SECOND,-1);return;case -1:h=h.getFirstDateOfMonth();i=h.getDay()-this.startDay;if(i<0){i+=7}this.viewStart=h.add(Date.DAY,-i).clearTime(true);var f=h.add(Date.MONTH,1).add(Date.SECOND,-1);i=this.startDay;if(i>f.getDay()){i-=7}this.viewEnd=f.add(Date.DAY,6-f.getDay()+i);return;default:this.viewStart=h.add(Date.DAY,-i).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.weekCount*7).add(Date.SECOND,-1)}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(b){if(b.length<2){return}b.sort("ASC",function(l,m){var n=l.data,o=m.data,a=Ext.ensible.cal.EventMappings;if(n[a.IsAllDay.name]){return -1}else{if(o[a.IsAllDay.name]){return 1}}if(this.spansHavePriority){var k=Ext.ensible.Date.diffDays;if(k(n[a.StartDate.name],n[a.EndDate.name])>0){if(k(o[a.StartDate.name],o[a.EndDate.name])>0){if(n[a.StartDate.name].getTime()==o[a.StartDate.name].getTime()){return o[a.EndDate.name].getTime()-n[a.EndDate.name].getTime()}return n[a.StartDate.name].getTime()-o[a.StartDate.name].getTime()}return -1}else{if(k(o[a.StartDate.name],o[a.EndDate.name])>0){return 1}}return n[a.StartDate.name].getTime()-o[a.StartDate.name].getTime()}else{return n[a.StartDate.name].getTime()-o[a.StartDate.name].getTime()}}.createDelegate(this))},moveTo:function(c,e){if(Ext.isDate(c)){this.setStartDate(c,e);return this.startDate}return c},moveNext:function(b){return this.moveTo(this.viewEnd.add(Date.DAY,1),b)},movePrev:function(e){var c=Ext.ensible.Date.diffDays(this.viewStart,this.viewEnd)+1;return this.moveDays(-c,e)},moveMonths:function(c,e){return this.moveTo(this.startDate.add(Date.MONTH,c),e)},moveWeeks:function(c,e){return this.moveTo(this.startDate.add(Date.DAY,c*7),e)},moveDays:function(c,e){return this.moveTo(this.startDate.add(Date.DAY,c),e)},moveToday:function(b){return this.moveTo(new Date(),b)},setStore:function(f,e){var g=this.store;if(!e&&g){g.un("datachanged",this.onDataChanged,this);g.un("clear",this.refresh,this);g.un("write",this.onWrite,this);g.un("exception",this.onException,this)}if(f){f.on("datachanged",this.onDataChanged,this);f.on("clear",this.refresh,this);f.on("write",this.onWrite,this);f.on("exception",this.onException,this)}this.store=f},onException:function(n,m,l,k,h,i){if(i.reject){i.reject()}},setCalendarStore:function(e,c){if(!c&&this.calendarStore){this.calendarStore.un("datachanged",this.refresh,this);this.calendarStore.un("add",this.refresh,this);this.calendarStore.un("remove",this.refresh,this);this.calendarStore.un("update",this.refresh,this)}if(e){e.on("datachanged",this.refresh,this);e.on("add",this.refresh,this);e.on("remove",this.refresh,this);e.on("update",this.refresh,this)}this.calendarStore=e},getEventRecord:function(c){var e=this.store.find(Ext.ensible.cal.EventMappings.EventId.name,c,0,false,true);return this.store.getAt(e)},getEventRecordFromEl:function(b){return this.getEventRecord(this.getEventIdFromEl(b))},getEventEditor:function(){this.editWin=this.editWin||Ext.WindowMgr.get("ext-cal-editwin");if(!this.editWin){this.editWin=new Ext.ensible.cal.EventEditWindow({id:"ext-cal-editwin",calendarStore:this.calendarStore,modal:this.editModal,enableEditDetails:this.enableEditDetails,listeners:{eventadd:{fn:function(e,g,f){e.currentView.onEventAdd(null,g)},scope:this},eventupdate:{fn:function(e,g,f){e.currentView.onEventUpdate(null,g)},scope:this},eventdelete:{fn:function(e,g,f){e.currentView.onEventDelete(null,g)},scope:this},editdetails:{fn:function(i,h,f,g){i.hide(f);i.currentView.fireEvent("editdetails",i.currentView,h,f)},scope:this},eventcancel:{fn:function(e,g,f){this.dismissEventEditor(f);e.currentView.onEventCancel()},scope:this}}})}this.editWin.currentView=this;return this.editWin},showEventEditor:function(c,e){this.getEventEditor().show(c,e,this);return this},dismissEventEditor:function(e,g){if(this.newRecord&&this.newRecord.phantom){this.store.remove(this.newRecord)}delete this.newRecord;var f=Ext.WindowMgr.get("ext-cal-editwin");if(f){f[e?e:"hide"](g)}return this},save:function(){if(!this.store.autoSave){this.store.save()}},onWrite:function(h,l,g,i,k){switch(l){case"create":this.onAdd(h,k);break;case"update":this.onUpdate(h,k,Ext.data.Record.COMMIT);break;case"destroy":this.onRemove(h,k);break}},onEventAdd:function(e,c){this.newRecord=c;if(!c.store){this.store.add(c);this.save()}this.fireEvent("eventadd",this,c)},onEventUpdate:function(e,c){this.save();this.fireEvent("eventupdate",this,c)},onEventDelete:function(e,c){if(c.store){this.store.remove(c)}this.save();this.fireEvent("eventdelete",this,c)},onEventCancel:function(e,c){this.fireEvent("eventcancel",this,c)},onDayClick:function(l,g,h){if(this.readOnly===true){return}if(this.fireEvent("dayclick",this,l,g,h)!==false){var i=Ext.ensible.cal.EventMappings,k={};k[i.StartDate.name]=l;k[i.IsAllDay.name]=g;this.showEventEditor(k,h)}},showEventMenu:function(e,c){if(!this.eventMenu){this.eventMenu=new Ext.ensible.cal.EventContextMenu({listeners:{editdetails:this.onEditDetails.createDelegate(this),eventdelete:this.onDeleteEvent.createDelegate(this),eventmove:this.onMoveEvent.createDelegate(this)}})}this.eventMenu.showForEvent(this.getEventRecordFromEl(e),e,c);this.menuActive=true},onEditDetails:function(g,e,f){this.fireEvent("editdetails",this,e,f);this.menuActive=false},onMoveEvent:function(g,e,f){this.moveEvent(e,f);this.menuActive=false},moveEvent:function(g,f){if(Ext.ensible.Date.compare(g.data[Ext.ensible.cal.EventMappings.StartDate.name],f)===0){return}if(this.fireEvent("beforeeventmove",this,g,f)!==false){var e=f.getTime()-g.data[Ext.ensible.cal.EventMappings.StartDate.name].getTime();g.beginEdit();g.set(Ext.ensible.cal.EventMappings.StartDate.name,f);g.set(Ext.ensible.cal.EventMappings.EndDate.name,g.data[Ext.ensible.cal.EventMappings.EndDate.name].add(Date.MILLI,e));g.endEdit();this.save();this.fireEvent("eventmove",this,g)}},onDeleteEvent:function(g,e,f){e._deleting=true;this.deleteEvent(e,f);this.menuActive=false},deleteEvent:function(c,e){if(this.fireEvent("beforeeventdelete",this,c,e)!==false){this.store.remove(c);this.save();this.fireEvent("eventdelete",this,c,e)}},onContextMenu:function(h,e){var i,g=false;if(i=h.getTarget(this.eventSelector,5,true)){this.dismissEventEditor().showEventMenu(i,h.getXY());g=true}if(g||this.suppressBrowserContextMenu===true){h.preventDefault()}},onClick:function(l,h){if(this.readOnly===true){return true}if(this.dropZone){this.dropZone.clearShims()}if(this.menuActive===true){this.menuActive=false;return true}var e=l.getTarget(this.eventSelector,5);if(e){var i=this.getEventIdFromEl(e),k=this.getEventRecord(i);if(this.fireEvent("eventclick",this,k,e)!==false){this.showEventEditor(k,e)}return true}},onMouseOver:function(c,e){if(this.trackMouseOver!==false&&(this.dragZone==undefined||!this.dragZone.dragging)){if(!this.handleEventMouseEvent(c,e,"over")){this.handleDayMouseEvent(c,e,"over")}}},onMouseOut:function(c,e){if(this.trackMouseOver!==false&&(this.dragZone==undefined||!this.dragZone.dragging)){if(!this.handleEventMouseEvent(c,e,"out")){this.handleDayMouseEvent(c,e,"out")}}},handleEventMouseEvent:function(m,p,n){var o;if(o=m.getTarget(this.eventSelector,5,true)){var k=Ext.get(m.getRelatedTarget());if(o==k||o.contains(k)){return true}var l=this.getEventIdFromEl(o);if(this.eventOverClass!=""){var e=this.getEventEls(l);e[n=="over"?"addClass":"removeClass"](this.eventOverClass)}this.fireEvent("event"+n,this,this.getEventRecord(l),o);return true}return false},getDateFromId:function(g,e){var f=g.split(e);return f[f.length-1]},handleDayMouseEvent:function(m,q,o){if(q=m.getTarget("td",3)){if(q.id&&q.id.indexOf(this.dayElIdDelimiter)>-1){var n=this.getDateFromId(q.id,this.dayElIdDelimiter),l=Ext.get(m.getRelatedTarget()),r,e;if(l){r=l.is("td")?l:l.up("td",3);e=r&&r.id?this.getDateFromId(r.id,this.dayElIdDelimiter):""}if(!l||n!=e){var p=this.getDayEl(n);if(p&&this.dayOverClass!=""){p[o=="over"?"addClass":"removeClass"](this.dayOverClass)}this.fireEvent("day"+o,this,Date.parseDate(n,"Ymd"),p)}}}},renderItems:function(){throw"This method must be implemented by a subclass"},destroy:function(){Ext.ensible.cal.CalendarView.superclass.destroy.call(this);if(this.el){this.el.un("contextmenu",this.onContextMenu,this)}Ext.destroy(this.editWin,this.eventMenu,this.dragZone,this.dropZone)}});Ext.ensible.cal.MonthView=Ext.extend(Ext.ensible.cal.CalendarView,{moreText:"+{0} more...",detailsTitleDateFormat:"F j",showTime:true,showTodayText:true,showHeader:false,showWeekLinks:false,showWeekNumbers:false,weekLinkOverClass:"ext-week-link-over",daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){Ext.ensible.cal.MonthView.superclass.initComponent.call(this);this.addEvents({dayclick:true,weekclick:true,dayover:true,dayout:true})},initDD:function(){var b={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,ddGroup:this.ddGroup||this.id+"-MonthViewDD"};this.dragZone=new Ext.ensible.cal.DragZone(this.el,b);this.dropZone=new Ext.ensible.cal.DropZone(this.el,b)},onDestroy:function(){Ext.destroy(this.ddSelector);Ext.destroy(this.dragZone);Ext.destroy(this.dropZone);Ext.ensible.cal.MonthView.superclass.onDestroy.call(this)},afterRender:function(){if(!this.tpl){this.tpl=new Ext.ensible.cal.MonthViewTemplate({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers})}this.tpl.compile();this.addClass("ext-cal-monthview ext-cal-ct");Ext.ensible.cal.MonthView.superclass.afterRender.call(this)},onResize:function(){if(this.monitorResize){this.maxEventsPerDay=this.getMaxEventsPerDay();this.refresh()}},forceSize:function(){if(this.showWeekLinks&&this.el&&this.el.child){var i=this.el.select(".ext-cal-hd-days-tbl"),k=this.el.select(".ext-cal-bg-tbl"),l=this.el.select(".ext-cal-evt-tbl"),g=this.el.child(".ext-cal-week-link").getWidth(),h=this.el.getWidth()-g;i.setWidth(h);k.setWidth(h);l.setWidth(h)}Ext.ensible.cal.MonthView.superclass.forceSize.call(this)},initClock:function(){if(Ext.fly(this.id+"-clock")!==null){this.prevClockDay=new Date().getDay();if(this.clockTask){Ext.TaskMgr.stop(this.clockTask)}this.clockTask=Ext.TaskMgr.start({run:function(){var c=Ext.fly(this.id+"-clock"),e=new Date();if(e.getDay()==this.prevClockDay){if(c){c.update(e.format(Ext.ensible.Date.use24HourTime?"G:i":"g:ia"))}}else{this.prevClockDay=e.getDay();this.moveTo(e)}},scope:this,interval:1000})}},getMoreText:function(b){return this.moreText},getEventBodyMarkup:function(){if(!this.eventBodyMarkup){this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>",'<tpl if="spanLeft">','<i class="ext-cal-spl">&#160;</i>',"</tpl>",'<tpl if="spanRight">','<i class="ext-cal-spr">&#160;</i>',"</tpl>"].join("")}return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var c,e=this.getEventBodyMarkup();c=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr">',e,"</div>"):new Ext.XTemplate('<tpl if="_renderAsAllDay">','<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div class="{_extraCls} ext-cal-evt ext-cal-evr">',"</tpl>",e,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>");c.compile();this.eventTpl=c}return this.eventTpl},getTemplateEventData:function(n){var p=Ext.ensible.cal.EventMappings,r=[this.getEventSelectorCls(n[p.EventId.name])],q={},u=n[p.RRule.name]!="",v="x-cal-default",o=n[p.Title.name],t=Ext.ensible.Date.use24HourTime?"G:i ":"g:ia ";if(this.calendarStore&&n[p.CalendarId.name]){var s=this.calendarStore.getById(n[p.CalendarId.name]);if(s){v="x-cal-"+s.data[Ext.ensible.cal.CalendarMappings.ColorId.name]}}v+=(n._renderAsAllDay?"-ad":"");r.push(v);if(this.getEventClass){var s=this.getEventRecord(n[p.EventId.name]),m=this.getEventClass(s,!!n._renderAsAllDay,q,this.store);r.push(m)}q._extraCls=r.join(" ");q._isRecurring=n.Recurrence&&n.Recurrence!="";q._isReminder=n[p.Reminder.name]&&n[p.Reminder.name]!="";q.Title=(n[p.IsAllDay.name]?"":n[p.StartDate.name].format(t))+(!o||o.length==0?this.defaultEventTitleText:o);return Ext.applyIf(q,n)},refresh:function(b){Ext.ensible.log("refresh (MonthView)");if(this.detailPanel){this.detailPanel.hide()}Ext.ensible.cal.MonthView.superclass.refresh.call(this,b);if(this.showTime!==false){this.initClock()}},renderItems:function(){Ext.ensible.cal.WeekEventRenderer.render({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,viewId:this.id,templateDataFn:this.getTemplateEventData.createDelegate(this),evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount,getMoreText:this.getMoreText.createDelegate(this)});this.fireEvent("eventsrendered",this)},getDayEl:function(b){return Ext.get(this.getDayId(b))},getDayId:function(b){if(Ext.isDate(b)){b=b.format("Ymd")}return this.id+this.dayElIdDelimiter+b},getWeekIndex:function(c){var e=this.getDayEl(c).up(".ext-cal-wk-ct");return parseInt(e.id.split("-wk-")[1])},getDaySize:function(k){var n=this.el.getBox(),l=this.getViewPadding(),i=(n.width-l.width)/this.dayCount,h=(n.height-l.height)/this.getWeekCount();if(k){var m=this.el.select(".ext-cal-dtitle").last().parent("tr");h=m?h-m.getHeight(true):h}return{height:h,width:i}},getEventHeight:function(){if(!this.eventHeight){var b=this.el.select(".ext-cal-evt").first();if(b){this.eventHeight=b.parent("td").getHeight()}else{return 16}}return this.eventHeight},getMaxEventsPerDay:function(){var f=this.getDaySize(true).height,i=this.getEventHeight(),h=5,g=Math.max(Math.floor((f-i-h)/i),0);return g},getViewPadding:function(m){var m=m||"tlbr",k=m.indexOf("t")>-1,l=m.indexOf("l")>-1,h=m.indexOf("r")>-1,i=this.showHeader&&k?this.el.select(".ext-cal-hd-days-tbl").first().getHeight():0,n=0;if(this.isHeaderView){if(l){n=this.el.select(".ext-cal-gutter").first().getWidth()}if(h){n+=this.el.select(".ext-cal-gutter-rt").first().getWidth()}}else{if(this.showWeekLinks&&l){n=this.el.select(".ext-cal-week-link").first().getWidth()}}return{height:i,width:n}},getDayAt:function(m,p){var r=this.el.getBox(),o=this.getViewPadding("tl"),n=this.getDaySize(),q=Math.floor(((m-r.x-o.width)/n.width)),s=Math.floor(((p-r.y-o.height)/n.height)),l=(s*7)+q;var t=this.viewStart.add(Date.DAY,l);return{date:t,el:this.getDayEl(t)}},moveNext:function(){return this.moveMonths(1,true)},movePrev:function(){return this.moveMonths(-1,true)},onInitDrag:function(){Ext.ensible.cal.MonthView.superclass.onInitDrag.call(this);Ext.select(this.daySelector).removeClass(this.dayOverClass);if(this.detailPanel){this.detailPanel.hide()}},onMoreClick:function(b){if(!this.detailPanel){this.detailPanel=new Ext.Panel({id:this.id+"-details-panel",title:b.format(this.detailsTitleDateFormat),layout:"fit",floating:true,renderTo:Ext.getBody(),tools:[{id:"close",handler:function(e,a,g){g.hide()}}],items:{xtype:"extensible.monthdaydetailview",id:this.id+"-details-view",date:b,view:this,store:this.store,calendarStore:this.calendarStore,listeners:{eventsrendered:this.onDetailViewUpdated.createDelegate(this)}}});if(this.enableContextMenus&&this.readOnly!==true){this.detailPanel.body.on("contextmenu",this.onContextMenu,this)}}else{this.detailPanel.setTitle(b.format(this.detailsTitleDateFormat))}this.detailPanel.getComponent(this.id+"-details-view").update(b)},onDetailViewUpdated:function(n,r,m){var s=this.detailPanel,p=s.getFrameHeight(),l=this.getEventHeight(),t=p+(m*l)+3,o=this.getDayEl(r),q=o.getBox();s.setHeight(t);s.setWidth(Math.max(q.width,220));s.show();s.getPositionEl().alignTo(o,"t-t?")},onHide:function(){Ext.ensible.cal.MonthView.superclass.onHide.call(this);if(this.detailPanel){this.detailPanel.hide()}},onClick:function(h,g){if(this.detailPanel){this.detailPanel.hide()}if(el=h.getTarget(this.moreSelector,3)){var e=el.id.split(this.moreElIdDelimiter)[1];this.onMoreClick(Date.parseDate(e,"Ymd"));return}if(el=h.getTarget(this.weekLinkSelector,3)){var e=el.id.split(this.weekLinkIdDelimiter)[1];this.fireEvent("weekclick",this,Date.parseDate(e,"Ymd"));return}if(Ext.ensible.cal.MonthView.superclass.onClick.apply(this,arguments)){return}if(el=h.getTarget("td",3)){if(el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){var i=el.id.split(this.dayElIdDelimiter),e=i[i.length-1];this.onDayClick(Date.parseDate(e,"Ymd"),false,Ext.get(this.getDayId(e)));return}}},handleDayMouseEvent:function(h,g,i){var e=h.getTarget(this.weekLinkSelector,3,true);if(e){e[i=="over"?"addClass":"removeClass"](this.weekLinkOverClass);return}Ext.ensible.cal.MonthView.superclass.handleDayMouseEvent.apply(this,arguments)},destroy:function(){Ext.ensible.cal.MonthView.superclass.destroy.call(this);if(this.detailsPanel){this.detailPanel.body.un("contextmenu",this.onContextMenu,this)}}});Ext.reg("extensible.monthview",Ext.ensible.cal.MonthView);Ext.ensible.cal.DayHeaderView=Ext.extend(Ext.ensible.cal.MonthView,{weekCount:1,dayCount:1,allDayOnly:true,monitorResize:false,isHeaderView:true,afterRender:function(){if(!this.tpl){this.tpl=new Ext.ensible.cal.DayHeaderTemplate({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime})}this.tpl.compile();this.addClass("ext-cal-day-header");Ext.ensible.cal.DayHeaderView.superclass.afterRender.call(this)},forceSize:Ext.emptyFn,refresh:function(b){Ext.ensible.log("refresh (DayHeaderView)");Ext.ensible.cal.DayHeaderView.superclass.refresh.call(this,b);this.recalcHeaderBox()},recalcHeaderBox:function(){var c=this.el.child(".ext-cal-evt-tbl"),e=c.getHeight();this.el.setHeight(e+7);this.el.child(".ext-cal-hd-ad-inner").setHeight(e+5);this.el.child(".ext-cal-bg-tbl").setHeight(e+5)},moveNext:function(){return this.moveDays(this.dayCount)},movePrev:function(){return this.moveDays(-this.dayCount)},onClick:function(h,g){if(el=h.getTarget("td",3)){if(el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){var i=el.id.split(this.dayElIdDelimiter),e=i[i.length-1];this.onDayClick(Date.parseDate(e,"Ymd"),true,Ext.get(this.getDayId(e,true)));return}}Ext.ensible.cal.DayHeaderView.superclass.onClick.apply(this,arguments)}});Ext.reg("extensible.dayheaderview",Ext.ensible.cal.DayHeaderView);Ext.ensible.cal.DayBodyView=Ext.extend(Ext.ensible.cal.CalendarView,{dayColumnElIdDelimiter:"-day-col-",hourIncrement:60,initComponent:function(){Ext.ensible.cal.DayBodyView.superclass.initComponent.call(this);if(this.readOnly===true){this.enableEventResize=false}this.incrementsPerHour=this.hourIncrement/this.ddIncrement;this.minEventHeight=this.minEventDisplayMinutes/(this.hourIncrement/this.hourHeight);this.addEvents({beforeeventresize:true,eventresize:true,dayclick:true})},initDD:function(){var b={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText,ddIncrement:this.ddIncrement,ddGroup:this.ddGroup||this.id+"-DayViewDD"};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:this.ddGroup||this.id+"-DayViewDD"};this.dragZone=new Ext.ensible.cal.DayViewDragZone(this.el,Ext.apply({containerScroll:true},b));this.dropZone=new Ext.ensible.cal.DayViewDropZone(this.el,b)},refresh:function(e){Ext.ensible.log("refresh (DayBodyView)");var c=this.el.getScroll().top;Ext.ensible.cal.DayBodyView.superclass.refresh.call(this,e);if(this.scrollReady){this.scrollTo(c)}},scrollTo:function(c,e){e=e||(Ext.isIE||Ext.isOpera);if(e){(function(){this.el.scrollTo("top",c);this.scrollReady=true}).defer(10,this)}else{this.el.scrollTo("top",c);this.scrollReady=true}},afterRender:function(){if(!this.tpl){this.tpl=new Ext.ensible.cal.DayBodyTemplate({id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,hourIncrement:this.hourIncrement,hourHeight:this.hourHeight})}this.tpl.compile();this.addClass("ext-cal-body-ct");Ext.ensible.cal.DayBodyView.superclass.afterRender.call(this);var c=Math.max(this.scrollStartHour,this.viewStartHour),e=Math.max(0,c-this.viewStartHour);if(e>0){this.scrollTo(e*this.hourHeight)}},forceSize:Ext.emptyFn,onEventResize:function(k,g){if(this.fireEvent("beforeeventresize",this,k,g)!==false){var l=Ext.ensible.Date,i=Ext.ensible.cal.EventMappings.StartDate.name,h=Ext.ensible.cal.EventMappings.EndDate.name;if(l.compare(k.data[i],g.StartDate)===0&&l.compare(k.data[h],g.EndDate)===0){return}k.set(i,g.StartDate);k.set(h,g.EndDate);this.onEventUpdate(null,k);this.fireEvent("eventresize",this,k)}},getEventBodyMarkup:function(){if(!this.eventBodyMarkup){this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>"].join("")}return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){this.eventTpl=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_extraCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="ext-evt-bd">',this.getEventBodyMarkup(),"</div>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</div>"):new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt {_extraCls}" style="left: {_left}%; width: {_width}%; top: {_top}px;">','<div class="ext-cal-evb">&#160;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd">',this.getEventBodyMarkup(),"</dd>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</dl>",'<div class="ext-cal-evb">&#160;</div>',"</div>");this.eventTpl.compile()}return this.eventTpl},getEventAllDayTemplate:function(){if(!this.eventAllDayTpl){var c,e=this.getEventBodyMarkup();c=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',e,"</div>"):new Ext.XTemplate('<div class="ext-cal-evt" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="{_extraCls} {spanCls} ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',e,"</div>","</div>","</div></div>");c.compile();this.eventAllDayTpl=c}return this.eventAllDayTpl},getTemplateEventData:function(n){var p=Ext.ensible.cal.EventMappings,r=[this.getEventSelectorCls(n[p.EventId.name])],q={},v="x-cal-default",o=n[p.Title.name],t=Ext.ensible.Date.use24HourTime?"G:i ":"g:ia ",u=n[p.RRule.name]!="";this.getTemplateEventBox(n);if(this.calendarStore&&n[p.CalendarId.name]){var s=this.calendarStore.getById(n[p.CalendarId.name]);if(s){v="x-cal-"+s.data[Ext.ensible.cal.CalendarMappings.ColorId.name]}}v+=(n._renderAsAllDay?"-ad":"")+(Ext.isIE||Ext.isOpera?"-x":"");r.push(v);if(this.getEventClass){var s=this.getEventRecord(n[p.EventId.name]),m=this.getEventClass(s,!!n._renderAsAllDay,q,this.store);r.push(m)}q._extraCls=r.join(" ");q._isRecurring=n.Recurrence&&n.Recurrence!="";q._isReminder=n[p.Reminder.name]&&n[p.Reminder.name]!="";q.Title=(n[p.IsAllDay.name]?"":n[p.StartDate.name].format(t))+(!o||o.length==0?this.defaultEventTitleText:o);return Ext.applyIf(q,n)},getEventPositionOffsets:function(){return{top:1,height:-2}},getTemplateEventBox:function(n){var t=this.hourHeight/this.hourIncrement,u=n[Ext.ensible.cal.EventMappings.StartDate.name],s=n[Ext.ensible.cal.EventMappings.EndDate.name],p=Math.max(u.getHours()-this.viewStartHour,0),o=Math.min(s.getHours()-this.viewStartHour,this.viewEndHour-this.viewStartHour),v=p*this.hourIncrement,r=o*this.hourIncrement,m=s.clearTime(true).add(Date.HOUR,this.viewEndHour),q=this.getEventPositionOffsets();if(u.getHours()>=this.viewStartHour){v+=u.getMinutes()}if(s<=m){r+=s.getMinutes()}n._left=0;n._width=100;n._top=v*t+q.top;n._height=Math.max(((r-v)*t),this.minEventHeight)+q.height},renderItems:function(){var H=0,P=[];for(;H<this.dayCount;H++){var C=emptyCells=skipped=0,B=this.eventGrid[0][H],Q=B?B.length:0,M;for(;C<Q;C++){M=B[C];if(!M){continue}var D=M.data||M.event.data,O=Ext.ensible.cal.EventMappings,A=D[O.IsAllDay.name]===true,I=Ext.ensible.Date.diffDays(D[O.StartDate.name],D[O.EndDate.name])>0,N=A||I;if(N){continue}Ext.apply(D,{cls:"ext-cal-ev",_positioned:true});P.push({data:this.getTemplateEventData(D),date:this.viewStart.add(Date.DAY,H)})}}var G=j=0,F=[],K=P.length,R;for(;G<K;G++){var M=P[G].data,J=null,L=M[Ext.ensible.cal.EventMappings.StartDate.name].getDate();for(j=0;j<K;j++){if(G==j){continue}J=P[j].data;if(this.isOverlapping(M,J)){M._overlap=M._overlap==undefined?1:M._overlap+1;if(G<j){if(M._overcol===undefined){M._overcol=0}J._overcol=M._overcol+1;F[L]=F[L]?Math.max(F[L],J._overcol):J._overcol}}}}for(G=0;G<K;G++){var M=P[G].data,L=M[Ext.ensible.cal.EventMappings.StartDate.name].getDate();if(M._overlap!==undefined){var z=100/(F[L]+1),i=100-(z*M._overlap);M._width=z;M._left=z*M._overcol}var E=this.getEventTemplate().apply(M),l=this.id+"-day-col-"+P[G].date.format("Ymd");Ext.DomHelper.append(l,E)}this.fireEvent("eventsrendered",this)},getDayEl:function(b){return Ext.get(this.getDayId(b))},getDayId:function(b){if(Ext.isDate(b)){b=b.format("Ymd")}return this.id+this.dayColumnElIdDelimiter+b},getDaySize:function(){var b=this.el.child(".ext-cal-day-col-inner").getBox();return{height:b.height,width:b.width}},getDayAt:function(w,A){var E=".ext-cal-body-ct",C=this.el.child(".ext-cal-day-times").getWidth(),J=this.el.getBox(),x=this.getDaySize(false),v=w-J.x-C,I=Math.floor(v/x.width),y=this.el.getScroll(),t=this.el.child(".ext-cal-bg-row"),u=t.getHeight()/this.incrementsPerHour,z=A-J.y-u+y.top,B=Math.max(0,Math.ceil(z/u)),H=B*(this.hourIncrement/this.incrementsPerHour),F=this.viewStart.add(Date.DAY,I).add(Date.MINUTE,H).add(Date.HOUR,this.viewStartHour),G=this.getDayEl(F),D=w;if(G){D=G.getLeft()}return{date:F,el:G,timeBox:{x:D,y:(B*this.hourHeight/this.incrementsPerHour)+J.y-y.top,width:x.width,height:u}}},onClick:function(i,e){if(this.dragPending||Ext.ensible.cal.DayBodyView.superclass.onClick.apply(this,arguments)){return}if(i.getTarget(".ext-cal-day-times",3)!==null){return}var l=i.getTarget("td",3);if(l){if(l.id&&l.id.indexOf(this.dayElIdDelimiter)>-1){var k=this.getDateFromId(l.id,this.dayElIdDelimiter);this.onDayClick(Date.parseDate(k,"Ymd"),true,Ext.get(this.getDayId(k)));return}}var h=this.getDayAt(i.xy[0],i.xy[1]);if(h&&h.date){this.onDayClick(h.date,false,null)}}});Ext.reg("extensible.daybodyview",Ext.ensible.cal.DayBodyView);Ext.ensible.cal.DayView=Ext.extend(Ext.Container,{ddCreateEventText:Ext.ensible.cal.CalendarView.prototype.ddCreateEventText,ddMoveEventText:Ext.ensible.cal.CalendarView.prototype.ddMoveEventText,showTime:true,showTodayText:true,dayCount:1,enableEventResize:true,ddIncrement:30,minEventDisplayMinutes:30,showHourSeparator:true,viewStartHour:0,viewEndHour:24,scrollStartHour:7,hourHeight:42,hideMode:"offsets",initComponent:function(){this.dayCount=this.dayCount>7?7:(this.dayCount<1?1:this.dayCount);var e=Ext.apply({},this.initialConfig);e.showTime=this.showTime;e.showTodayText=this.showTodayText;e.todayText=this.todayText;e.dayCount=this.dayCount;e.weekCount=1;e.readOnly=this.readOnly;e.ddIncrement=this.ddIncrement;e.minEventDisplayMinutes=this.minEventDisplayMinutes;var g=Ext.applyIf({xtype:"extensible.dayheaderview",id:this.id+"-hd",ownerCalendarPanel:this.ownerCalendarPanel},e);var f=Ext.applyIf({xtype:"extensible.daybodyview",enableEventResize:this.enableEventResize,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,scrollStartHour:this.scrollStartHour,hourHeight:this.hourHeight,id:this.id+"-bd",ownerCalendarPanel:this.ownerCalendarPanel},e);this.items=[g,f];this.addClass("ext-cal-dayview ext-cal-ct");Ext.ensible.cal.DayView.superclass.initComponent.call(this)},afterRender:function(){Ext.ensible.cal.DayView.superclass.afterRender.call(this);this.header=Ext.getCmp(this.id+"-hd");this.body=Ext.getCmp(this.id+"-bd");this.body.on("eventsrendered",this.forceSize,this)},refresh:function(){Ext.ensible.log("refresh (DayView)");this.header.refresh();this.body.refresh()},forceSize:function(){(function(){var f=this.el.up(".x-panel-body"),g=this.el.child(".ext-cal-day-header"),e;if(f&&g){e=f.getHeight()-g.getHeight();this.el.child(".ext-cal-body-ct").setHeight(e-1)}}).defer(10,this)},onResize:function(){this.forceSize();this.refresh.defer(1,this)},doHide:function(){this.header.doHide.apply(this,arguments);this.body.doHide.apply(this,arguments)},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(b){this.header.setStartDate(b,true);this.body.setStartDate(b)},renderItems:function(){this.header.renderItems();this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(b){this.header.moveTo(b);return this.body.moveTo(b,true)},moveNext:function(){this.header.moveNext();return this.body.moveNext(true)},movePrev:function(b){this.header.movePrev();return this.body.movePrev(true)},moveDays:function(b){this.header.moveDays(b);return this.body.moveDays(b,true)},moveToday:function(){this.header.moveToday();return this.body.moveToday(true)},showEventEditor:function(c,e){return Ext.ensible.cal.CalendarView.prototype.showEventEditor.apply(this,arguments)},dismissEventEditor:function(b){return Ext.ensible.cal.CalendarView.prototype.dismissEventEditor.apply(this,arguments)}});Ext.reg("extensible.dayview",Ext.ensible.cal.DayView);Ext.ensible.cal.MultiDayView=Ext.extend(Ext.ensible.cal.DayView,{dayCount:3,startDayIsStatic:false,moveNext:function(b){return this.moveDays(this.startDayIsStatic?7:this.dayCount,b)},movePrev:function(b){return this.moveDays(this.startDayIsStatic?-7:-this.dayCount,b)}});Ext.reg("extensible.multidayview",Ext.ensible.cal.MultiDayView);Ext.ensible.cal.WeekView=Ext.extend(Ext.ensible.cal.MultiDayView,{dayCount:7});Ext.reg("extensible.weekview",Ext.ensible.cal.WeekView);Ext.ensible.cal.MultiWeekView=Ext.extend(Ext.ensible.cal.MonthView,{weekCount:2,moveNext:function(){return this.moveWeeks(this.weekCount,true)},movePrev:function(){return this.moveWeeks(-this.weekCount,true)}});Ext.reg("extensible.multiweekview",Ext.ensible.cal.MultiWeekView);Ext.ensible.cal.MonthDayDetailView=Ext.extend(Ext.BoxComponent,{initComponent:function(){Ext.ensible.cal.CalendarView.superclass.initComponent.call(this);this.addEvents({eventsrendered:true});if(!this.el){this.el=document.createElement("div")}},afterRender:function(){this.tpl=this.getTemplate();Ext.ensible.cal.MonthDayDetailView.superclass.afterRender.call(this);this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){if(!this.tpl){this.tpl=new Ext.XTemplate('<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>")}this.tpl.compile();return this.tpl},update:function(b){this.date=b;this.refresh()},refresh:function(){if(!this.rendered){return}var e=this.view.getEventTemplate(),c=[];evts=this.store.queryBy(function(s){var q=this.date.clearTime(true).getTime(),n=Ext.ensible.cal.EventMappings,o=s.data[n.StartDate.name].clearTime(true).getTime(),r=(q==o),p=false,a=s.data[n.CalendarId.name],t=this.calendarStore?this.calendarStore.getById(a):null;if(t&&t.data[Ext.ensible.cal.CalendarMappings.IsHidden.name]===true){return false}if(!r){var b=s.data[Ext.ensible.cal.EventMappings.EndDate.name].clearTime(true).getTime();p=o<q&&b>=q}return r||p},this);Ext.ensible.cal.CalendarView.prototype.sortEventRecordsForDay.call(this,evts);evts.each(function(g){var b=g.data,a=Ext.ensible.cal.EventMappings;b._renderAsAllDay=b[a.IsAllDay.name]||Ext.ensible.Date.diffDays(b[a.StartDate.name],b[a.EndDate.name])>0;b.spanLeft=Ext.ensible.Date.diffDays(b[a.StartDate.name],this.date)>0;b.spanRight=Ext.ensible.Date.diffDays(this.date,b[a.EndDate.name])>0;b.spanCls=(b.spanLeft?(b.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft"):(b.spanRight?"ext-cal-ev-spanright":""));c.push({markup:e.apply(this.getTemplateEventData(b))})},this);this.tpl.overwrite(this.el,c);this.fireEvent("eventsrendered",this,this.date,evts.getCount())},getTemplateEventData:function(e){var c=this.view.getTemplateEventData(e);c._elId="dtl-"+c._elId;return c}});Ext.reg("extensible.monthdaydetailview",Ext.ensible.cal.MonthDayDetailView);Ext.ensible.cal.CalendarPanel=Ext.extend(Ext.Panel,{enableRecurrence:false,showDayView:true,showMultiDayView:false,showWeekView:true,showMultiWeekView:true,showMonthView:true,showNavBar:true,todayText:"Today",showTodayText:true,showTime:true,readOnly:false,showNavToday:true,showNavJump:true,showNavNextPrev:true,jumpToText:"Jump to:",goText:"Go",dayText:"Day",multiDayText:"{0} Days",weekText:"Week",multiWeekText:"{0} Weeks",monthText:"Month",editModal:false,enableEditDetails:true,layoutConfig:{layoutOnCardChange:true,deferredRender:true},startDate:new Date(),initComponent:function(){this.tbar={cls:"ext-cal-toolbar",border:true,items:[]};this.viewCount=0;var u=(this.multiDayViewCfg&&this.multiDayViewCfg.dayCount)||3,q=(this.multiWeekViewCfg&&this.multiWeekViewCfg.weekCount)||2;if(this.showNavToday){this.tbar.items.push({id:this.id+"-tb-today",text:this.todayText,handler:this.onTodayClick,scope:this})}if(this.showNavNextPrev){this.tbar.items.push([{id:this.id+"-tb-prev",handler:this.onPrevClick,scope:this,iconCls:"x-tbar-page-prev"},{id:this.id+"-tb-next",handler:this.onNextClick,scope:this,iconCls:"x-tbar-page-next"}])}if(this.showNavJump){this.tbar.items.push([this.jumpToText,{id:this.id+"-tb-jump-dt",xtype:"datefield",showToday:false},{id:this.id+"-tb-jump",text:this.goText,handler:this.onJumpClick,scope:this}])}this.tbar.items.push("->");if(this.showDayView){this.tbar.items.push({id:this.id+"-tb-day",text:this.dayText,handler:this.onDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"});this.viewCount++}if(this.showMultiDayView){var o=String.format(this.getMultiDayText(u),u);this.tbar.items.push({id:this.id+"-tb-multiday",text:o,handler:this.onMultiDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"});this.viewCount++}if(this.showWeekView){this.tbar.items.push({id:this.id+"-tb-week",text:this.weekText,handler:this.onWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"});this.viewCount++}if(this.showMultiWeekView){var o=String.format(this.getMultiWeekText(q),q);this.tbar.items.push({id:this.id+"-tb-multiweek",text:o,handler:this.onMultiWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"});this.viewCount++}if(this.showMonthView||this.viewCount==0){this.tbar.items.push({id:this.id+"-tb-month",text:this.monthText,handler:this.onMonthNavClick,scope:this,toggleGroup:this.id+"-tb-views"});this.viewCount++;this.showMonthView=true}var p=this.viewCount-1;this.activeItem=this.activeItem===undefined?p:(this.activeItem>p?p:this.activeItem);if(this.showNavBar===false){delete this.tbar;this.addClass("x-calendar-nonav")}Ext.ensible.cal.CalendarPanel.superclass.initComponent.call(this);this.addEvents({eventadd:true,eventupdate:true,beforeeventdelete:true,eventdelete:true,eventcancel:true,viewchange:true,editdetails:true});this.layout="card";this.addClass("x-cal-panel");if(this.eventStore){this.store=this.eventStore;delete this.eventStore}this.setStore(this.store);var n={showToday:this.showToday,todayText:this.todayText,showTodayText:this.showTodayText,showTime:this.showTime,readOnly:this.readOnly,enableRecurrence:this.enableRecurrence,store:this.store,calendarStore:this.calendarStore,editModal:this.editModal,enableEditDetails:this.enableEditDetails,ownerCalendarPanel:this};if(this.showDayView){var r=Ext.apply({xtype:"extensible.dayview",title:this.dayText},n);r=Ext.apply(Ext.apply(r,this.viewConfig),this.dayViewCfg);r.id=this.id+"-day";this.initEventRelay(r);this.add(r)}if(this.showMultiDayView){var v=Ext.apply({xtype:"extensible.multidayview",title:this.getMultiDayText(u)},n);v=Ext.apply(Ext.apply(v,this.viewConfig),this.multiDayViewCfg);v.id=this.id+"-multiday";this.initEventRelay(v);this.add(v)}if(this.showWeekView){var m=Ext.applyIf({xtype:"extensible.weekview",title:this.weekText},n);m=Ext.apply(Ext.apply(m,this.viewConfig),this.weekViewCfg);m.id=this.id+"-week";this.initEventRelay(m);this.add(m)}if(this.showMultiWeekView){var s=Ext.applyIf({xtype:"extensible.multiweekview",title:this.getMultiWeekText(q)},n);s=Ext.apply(Ext.apply(s,this.viewConfig),this.multiWeekViewCfg);s.id=this.id+"-multiweek";this.initEventRelay(s);this.add(s)}if(this.showMonthView){var t=Ext.applyIf({xtype:"extensible.monthview",title:this.monthText,listeners:{weekclick:{fn:function(b,a){this.showWeek(a)},scope:this}}},n);t=Ext.apply(Ext.apply(t,this.viewConfig),this.monthViewCfg);t.id=this.id+"-month";this.initEventRelay(t);this.add(t)}this.add(Ext.applyIf({xtype:"extensible.eventeditform",id:this.id+"-edit",calendarStore:this.calendarStore,enableRecurrence:this.enableRecurrence,listeners:{eventadd:{scope:this,fn:this.onEventAdd},eventupdate:{scope:this,fn:this.onEventUpdate},eventdelete:{scope:this,fn:this.onEventDelete},eventcancel:{scope:this,fn:this.onEventCancel}}},this.editViewCfg))},initEventRelay:function(b){b.listeners=b.listeners||{};b.listeners.afterrender={fn:function(a){this.relayEvents(a,["eventsrendered","eventclick","dayclick","eventover","eventout","beforedatechange","datechange","rangeselect","beforeeventmove","eventmove","initdrag","dayover","dayout","beforeeventresize","eventresize","eventadd","eventupdate","beforeeventdelete","eventdelete","eventcancel"]);a.on("editdetails",this.onEditDetails,this)},scope:this,single:true}},afterRender:function(){Ext.ensible.cal.CalendarPanel.superclass.afterRender.call(this);this.body.addClass("x-cal-body");(function(){this.updateNavState();this.setActiveView()}).defer(1,this)},onLayout:function(){Ext.ensible.cal.CalendarPanel.superclass.onLayout.call(this);if(!this.navInitComplete){this.updateNavState();this.navInitComplete=true}},getMultiDayText:function(b){return this.multiDayText},getMultiWeekText:function(b){return this.multiWeekText},setStore:function(f,e){var g=this.store;if(!e&&g){g.un("write",this.onWrite,this)}if(f){f.on("write",this.onWrite,this)}this.store=f},onStoreAdd:function(i,f,g){var h=Ext.isArray(f)?f[0]:f;if(h.phantom){return}this.hideEditForm()},onStoreUpdate:function(e,g,f){if(f==Ext.data.Record.COMMIT){this.hideEditForm()}},onStoreRemove:function(e,c){this.hideEditForm()},onWrite:function(h,l,g,i,k){switch(l){case"create":this.onStoreAdd(h,k);break;case"update":this.onStoreUpdate(h,k,Ext.data.Record.COMMIT);break;case"destroy":this.onStoreRemove(h,k);break}},onEditDetails:function(e,g,f){if(this.fireEvent("editdetails",this,e,g,f)!==false){this.showEditForm(g)}},save:function(){if(!this.store.autoSave){this.store.save()}},onEventAdd:function(e,c){if(!c.store){this.store.add(c);this.save()}this.fireEvent("eventadd",this,c)},onEventUpdate:function(e,c){this.save();this.fireEvent("eventupdate",this,c)},onEventDelete:function(e,c){this.store.remove(c);this.save();this.fireEvent("eventdelete",this,c)},onEventCancel:function(e,c){this.hideEditForm();this.fireEvent("eventcancel",this,c)},showEditForm:function(b){this.preEditView=this.layout.activeItem.id;this.setActiveView(this.id+"-edit");this.layout.activeItem.loadRecord(b);return this},hideEditForm:function(){if(this.preEditView){this.setActiveView(this.preEditView);delete this.preEditView}return this},setActiveView:function(k,i){var l=this,m=l.layout,h=l.id+"-edit",n;if(i){l.startDate=i}if(k!==m.activeItem.id){n=l.getTopToolbar();if(n){n[k===h?"hide":"show"]()}m.setActiveItem(k||l.activeItem);l.doLayout();l.activeView=m.activeItem;if(k!==h){if(k&&k!==l.preEditView){m.activeItem.setStartDate(l.startDate,true)}l.updateNavState()}l.fireViewChange()}},fireViewChange:function(){var g=null,f=this.layout.activeItem;if(f.getViewBounds){var e=f.getViewBounds(),g={activeDate:f.getStartDate(),viewStart:e.start,viewEnd:e.end}}if(f.dismissEventEditor){f.dismissEventEditor()}this.fireEvent("viewchange",this,f,g)},updateNavState:function(){var f=this,h=f.layout.activeItem;if(h&&f.showNavBar!==false){var i=h.id.split(f.id+"-")[1],g=Ext.getCmp(f.id+"-tb-"+i);if(f.showNavToday){Ext.getCmp(f.id+"-tb-today").setDisabled(h.isToday())}g.toggle(true)}},setStartDate:function(b){Ext.ensible.log("setStartDate (CalendarPanel");this.startDate=b;this.layout.activeItem.setStartDate(b,true);this.updateNavState();this.fireViewChange();return this},showWeek:function(b){this.setActiveView(this.id+"-week",b)},onTodayClick:function(){this.startDate=this.layout.activeItem.moveToday(true);this.updateNavState();this.fireViewChange()},onJumpClick:function(){var b=Ext.getCmp(this.id+"-tb-jump-dt").getValue();if(b!==""){this.startDate=this.layout.activeItem.moveTo(b,true);this.updateNavState();this.fireViewChange()}},onPrevClick:function(){this.startDate=this.layout.activeItem.movePrev(true);this.updateNavState();this.fireViewChange()},onNextClick:function(){this.startDate=this.layout.activeItem.moveNext(true);this.updateNavState();this.fireViewChange()},onDayNavClick:function(){this.setActiveView(this.id+"-day")},onMultiDayNavClick:function(){this.setActiveView(this.id+"-multiday")},onWeekNavClick:function(){this.setActiveView(this.id+"-week")},onMultiWeekNavClick:function(){this.setActiveView(this.id+"-multiweek")},onMonthNavClick:function(){this.setActiveView(this.id+"-month")},getActiveView:function(){return this.layout.activeItem}});Ext.reg("extensible.calendarpanel",Ext.ensible.cal.CalendarPanel);