/*!
 * Extensible 1.0.2
 * Copyright(c) 2010-2012 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */
Ext.ensible.cal.MonthDayDetailView=Ext.extend(Ext.BoxComponent,{initComponent:function(){Ext.ensible.cal.CalendarView.superclass.initComponent.call(this);this.addEvents({eventsrendered:true});if(!this.el){this.el=document.createElement("div")}},afterRender:function(){this.tpl=this.getTemplate();Ext.ensible.cal.MonthDayDetailView.superclass.afterRender.call(this);this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){if(!this.tpl){this.tpl=new Ext.XTemplate('<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>")}this.tpl.compile();return this.tpl},update:function(a){this.date=a;this.refresh()},refresh:function(){if(!this.rendered){return}var a=this.view.getEventTemplate(),b=[];evts=this.store.queryBy(function(d){var f=this.date.clearTime(true).getTime(),i=Ext.ensible.cal.EventMappings,h=d.data[i.StartDate.name].clearTime(true).getTime(),e=(f==h),g=false,k=d.data[i.CalendarId.name],c=this.calendarStore?this.calendarStore.getById(k):null;if(c&&c.data[Ext.ensible.cal.CalendarMappings.IsHidden.name]===true){return false}if(!e){var j=d.data[Ext.ensible.cal.EventMappings.EndDate.name].clearTime(true).getTime();g=h<f&&j>=f}return e||g},this);Ext.ensible.cal.CalendarView.prototype.sortEventRecordsForDay.call(this,evts);evts.each(function(c){var d=c.data,e=Ext.ensible.cal.EventMappings;d._renderAsAllDay=d[e.IsAllDay.name]||Ext.ensible.Date.diffDays(d[e.StartDate.name],d[e.EndDate.name])>0;d.spanLeft=Ext.ensible.Date.diffDays(d[e.StartDate.name],this.date)>0;d.spanRight=Ext.ensible.Date.diffDays(this.date,d[e.EndDate.name])>0;d.spanCls=(d.spanLeft?(d.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft"):(d.spanRight?"ext-cal-ev-spanright":""));b.push({markup:a.apply(this.getTemplateEventData(d))})},this);this.tpl.overwrite(this.el,b);this.fireEvent("eventsrendered",this,this.date,evts.getCount())},getTemplateEventData:function(a){var b=this.view.getTemplateEventData(a);b._elId="dtl-"+b._elId;return b}});Ext.reg("extensible.monthdaydetailview",Ext.ensible.cal.MonthDayDetailView);