/*!
 * Extensible 1.0.2
 * Copyright(c) 2010-2012 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */
Ext.ensible.cal.EventEditForm=Ext.extend(Ext.form.FormPanel,{labelWidth:65,labelWidthRightCol:65,colWidthLeft:0.6,colWidthRight:0.4,title:"Event Form",titleTextAdd:"Add Event",titleTextEdit:"Edit Event",titleLabelText:"Title",datesLabelText:"When",reminderLabelText:"Reminder",notesLabelText:"Notes",locationLabelText:"Location",webLinkLabelText:"Web Link",calendarLabelText:"Calendar",repeatsLabelText:"Repeats",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",bodyStyle:"padding:20px 20px 10px;",border:false,buttonAlign:"center",autoHeight:true,enableRecurrence:false,layout:"column",cls:"ext-evt-edit-form",initComponent:function(){this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true});this.titleField=new Ext.form.TextField({fieldLabel:this.titleLabelText,name:Ext.ensible.cal.EventMappings.Title.name,anchor:"90%"});this.dateRangeField=new Ext.ensible.cal.DateRangeField({fieldLabel:this.datesLabelText,singleLine:false,anchor:"90%",listeners:{change:this.onDateChange.createDelegate(this)}});this.reminderField=new Ext.ensible.cal.ReminderField({name:Ext.ensible.cal.EventMappings.Reminder.name,fieldLabel:this.reminderLabelText});this.notesField=new Ext.form.TextArea({fieldLabel:this.notesLabelText,name:Ext.ensible.cal.EventMappings.Notes.name,grow:true,growMax:150,anchor:"100%"});this.locationField=new Ext.form.TextField({fieldLabel:this.locationLabelText,name:Ext.ensible.cal.EventMappings.Location.name,anchor:"100%"});this.urlField=new Ext.form.TextField({fieldLabel:this.webLinkLabelText,name:Ext.ensible.cal.EventMappings.Url.name,anchor:"100%"});var a=[this.titleField,this.dateRangeField,this.reminderField],b=[this.notesField,this.locationField,this.urlField];if(this.enableRecurrence){this.recurrenceField=new Ext.ensible.cal.RecurrenceField({name:Ext.ensible.cal.EventMappings.RRule.name,fieldLabel:this.repeatsLabelText,anchor:"100%"});a.splice(2,0,this.recurrenceField)}if(this.calendarStore){this.calendarField=new Ext.ensible.cal.CalendarCombo({store:this.calendarStore,fieldLabel:this.calendarLabelText,name:Ext.ensible.cal.EventMappings.CalendarId.name});a.splice(2,0,this.calendarField)}this.items=[{id:this.id+"-left-col",columnWidth:this.colWidthLeft,layout:"form",border:false,items:a},{id:this.id+"-right-col",columnWidth:this.colWidthRight,layout:"form",labelWidth:this.labelWidthRightCol||this.labelWidth,border:false,items:b}];this.fbar=[{text:this.saveButtonText,scope:this,handler:this.onSave},{cls:"ext-del-btn",text:this.deleteButtonText,scope:this,handler:this.onDelete},{text:this.cancelButtonText,scope:this,handler:this.onCancel}];Ext.ensible.cal.EventEditForm.superclass.initComponent.call(this)},onDateChange:function(a,b){if(this.recurrenceField){this.recurrenceField.setStartDate(b[0])}},loadRecord:function(a){this.form.reset().loadRecord.apply(this.form,arguments);this.activeRecord=a;this.dateRangeField.setValue(a.data);if(this.recurrenceField){this.recurrenceField.setStartDate(a.data[Ext.ensible.cal.EventMappings.StartDate.name])}if(this.calendarStore){this.form.setValues({calendar:a.data[Ext.ensible.cal.EventMappings.CalendarId.name]})}if(a.phantom){this.setTitle(this.titleTextAdd);Ext.select(".ext-del-btn").setDisplayed(false)}else{this.setTitle(this.titleTextEdit);Ext.select(".ext-del-btn").setDisplayed(true)}this.titleField.focus()},updateRecord:function(){var c=this.dateRangeField.getValue(),e=Ext.ensible.cal.EventMappings,d=this.activeRecord,a=d.fields,b=false;d.beginEdit();a.each(function(h){var i=this.form.findField(h.name);if(i){var g=i.getValue();if(g.getGroupValue){g=g.getGroupValue()}else{if(i.eachItem){g=[];i.eachItem(function(f){g.push(f.getValue())})}}d.set(h.name,g)}},this);d.set(e.StartDate.name,c[0]);d.set(e.EndDate.name,c[1]);d.set(e.IsAllDay.name,c[2]);b=d.dirty;d.endEdit();return b},onCancel:function(){this.cleanup(true);this.fireEvent("eventcancel",this,this.activeRecord)},cleanup:function(a){if(this.activeRecord){this.activeRecord.reject()}delete this.activeRecord;if(this.form.isDirty()){this.form.reset()}},onSave:function(){if(!this.form.isValid()){return}if(!this.updateRecord()){this.onCancel();return}this.fireEvent(this.activeRecord.phantom?"eventadd":"eventupdate",this,this.activeRecord)},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}});Ext.reg("extensible.eventeditform",Ext.ensible.cal.EventEditForm);