/*!
 * Extensible 1.0.2
 * Copyright(c) 2010-2012 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */
Ext.ensible.cal.CalendarList=Ext.extend(Ext.Panel,{title:"Calendars",collapsible:true,autoHeight:true,layout:"fit",menuSelector:"em",width:100,initComponent:function(){this.addClass("x-calendar-list");Ext.ensible.cal.CalendarList.superclass.initComponent.call(this)},afterRender:function(b,a){Ext.ensible.cal.CalendarList.superclass.afterRender.call(this);if(this.store){this.setStore(this.store,true)}this.refresh();this.body.on("click",this.onClick,this);this.body.on("mouseover",this.onMouseOver,this,{delegate:"li"});this.body.on("mouseout",this.onMouseOut,this,{delegate:"li"})},getListTemplate:function(){if(!this.tpl){this.tpl=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evr {colorCls} {hiddenCls}">{title}<em>&#160;</em></li>',"</tpl></ul>"):new Ext.XTemplate('<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evo {colorCls} {hiddenCls}">','<div class="ext-cal-evm">','<div class="ext-cal-evi">{title}<em>&#160;</em></div>',"</div>","</li>","</tpl></ul>");this.tpl.compile()}return this.tpl},setStore:function(a,b){if(!b&&this.store){this.store.un("load",this.refresh,this);this.store.un("add",this.refresh,this);this.store.un("remove",this.refresh,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.refresh,this)}if(a){a.on("load",this.refresh,this);a.on("add",this.refresh,this);a.on("remove",this.refresh,this);a.on("update",this.onUpdate,this);a.on("clear",this.refresh,this)}this.store=a},onUpdate:function(b,c,a){if(a==Ext.data.Record.COMMIT){this.refresh()}},refresh:function(){if(this.skipRefresh){return}var e=[],c=0,f=null,b=Ext.ensible.cal.CalendarMappings,d=this.store.getRange(),a=d.length;for(;c<a;c++){f={cmpId:this.id+"__"+d[c].data[b.CalendarId.name],title:d[c].data[b.Title.name],colorCls:this.getColorCls(d[c].data[b.ColorId.name])};if(d[c].data[b.IsHidden.name]===true){f.hiddenCls="ext-cal-hidden"}e[e.length]=f}this.getListTemplate().overwrite(this.body,e)},getColorCls:function(a){return"x-cal-"+a+"-ad"},toggleCalendar:function(e,d){var c=this.store.getById(e),a=Ext.ensible.cal.CalendarMappings,b=c.data[a.IsHidden.name];c.set([a.IsHidden.name],!b);if(d!==false){c.commit()}},showCalendar:function(c,b){var a=this.store.getById(c);if(a.data[Ext.ensible.cal.CalendarMappings.IsHidden.name]===true){this.toggleCalendar(c,b)}},hideCalendar:function(c,b){var a=this.store.getById(c);if(a.data[Ext.ensible.cal.CalendarMappings.IsHidden.name]!==true){this.toggleCalendar(c,b)}},radioCalendar:function(f){var b=0,e,c=Ext.ensible.cal.CalendarMappings.CalendarId.name,d=this.store.getRange(),a=d.length;for(;b<a;b++){e=d[b].data[c];if(e==f){this.showCalendar(e,false)}else{this.hideCalendar(e,false)}}this.skipRefresh=true;this.store.commitChanges();delete this.skipRefresh;this.refresh()},onMouseOver:function(b,a){Ext.fly(a).addClass("hover")},onMouseOut:function(b,a){Ext.fly(a).removeClass("hover")},getCalendarId:function(a){return a.id.split("__")[1]},getCalendarItemEl:function(a){return Ext.get(this.id+"__"+a)},onClick:function(c,a){var b;if(b=c.getTarget(this.menuSelector,3,true)){this.showEventMenu(b,c.getXY())}else{if(b=c.getTarget("li",3,true)){this.toggleCalendar(this.getCalendarId(b))}}},handleColorChange:function(d,e,c,a){var b=this.store.getById(e);b.data[Ext.ensible.cal.CalendarMappings.ColorId.name]=c;b.commit()},handleRadioCalendar:function(a,b){this.radioCalendar(b)},showEventMenu:function(a,b){var e=this.getCalendarId(a.parent("li")),d=this.store.getById(e),c=d.data[Ext.ensible.cal.CalendarMappings.ColorId.name];if(!this.menu){this.menu=new Ext.ensible.cal.CalendarListMenu();this.menu.on("colorchange",this.handleColorChange,this);this.menu.on("radiocalendar",this.handleRadioCalendar,this)}this.menu.setCalendar(e,c);this.menu.showAt(b)}});Ext.reg("extensible.calendarlist",Ext.ensible.cal.CalendarList);