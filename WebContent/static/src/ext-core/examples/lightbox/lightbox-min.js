Ext.ns("Ext.ux");Ext.ux.Lightbox=(function(){var c={},a=[],d,e=false,b=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?((11-this.resizeSpeed)*0.15):0;this.overlayDuration=this.animate?0.2:0;if(!e){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();e=true}},initMarkup:function(){c.shim=Ext.DomHelper.append(document.body,{tag:"iframe",id:"ux-lightbox-shim"},true);c.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var g=new Ext.Template(this.getTemplate());c.lightbox=g.append(document.body,{},true);var h=["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"];Ext.each(h,function(i){c[i]=Ext.get("ux-lightbox-"+i)});Ext.each([c.overlay,c.lightbox,c.shim],function(i){i.setVisibilityMode(Ext.Element.DISPLAY);i.hide()});var f=(this.animate?250:1)+"px";c.outerImageContainer.setStyle({width:f,height:f})},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"]},initEvents:function(){var f=function(g){g.preventDefault();this.close()};c.overlay.on("click",f,this);c.loadingLink.on("click",f,this);c.navClose.on("click",f,this);c.lightbox.on("click",function(g){if(g.getTarget().id=="ux-lightbox"){this.close()}},this);c.navPrev.on("click",function(g){g.preventDefault();this.setImage(d-1)},this);c.navNext.on("click",function(g){g.preventDefault();this.setImage(d+1)},this)},register:function(f,g){if(b.indexOf(f)===-1){b.push(f);Ext.fly(document).on("click",function(h){var i=h.getTarget(f);if(i){h.preventDefault();this.open(i,f,g)}},this)}},open:function(h,f,g){g=g||false;this.setViewSize();c.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){a=[];var i=0;if(!g){a.push([h.href,h.title])}else{var j=Ext.query(f);Ext.each(j,function(n){if(n.href){a.push([n.href,n.title])}});while(a[i][0]!=h.href){i++}}var l=Ext.fly(document).getScroll();var m=l.top+(Ext.lib.Dom.getViewportHeight()/10);var k=l.left;c.lightbox.setStyle({top:m+"px",left:k+"px"}).show();this.setImage(i);this.fireEvent("open",a[i])},scope:this})},setViewSize:function(){var f=this.getViewSize();c.overlay.setStyle({width:f[0]+"px",height:f[1]+"px"});c.shim.setStyle({width:f[0]+"px",height:f[1]+"px"}).show()},setImage:function(g){d=g;this.disableKeyNav();if(this.animate){c.loading.show()}c.image.hide();c.hoverNav.hide();c.navPrev.hide();c.navNext.hide();c.dataContainer.setOpacity(0.0001);c.imageNumber.hide();var f=new Image();f.onload=(function(){c.image.dom.src=a[d][0];this.resizeImage(f.width,f.height)}).createDelegate(this);f.src=a[d][0]},resizeImage:function(m,g){var o=c.outerImageContainer.getWidth();var k=c.outerImageContainer.getHeight();var j=(m+this.borderSize*2);var i=(g+this.borderSize*2);var l=o-j;var f=k-i;var n=function(){c.hoverNav.setWidth(c.imageContainer.getWidth()+"px");c.navPrev.setHeight(g+"px");c.navNext.setHeight(g+"px");c.outerDataContainer.setWidth(j+"px");this.showImage()};if(f!=0||l!=0){c.outerImageContainer.shift({height:i,width:j,duration:this.resizeDuration,scope:this,callback:n,delay:50})}else{n.call(this)}},showImage:function(){c.loading.hide();c.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails()}});this.preloadImages()},updateDetails:function(){var f=c.data.getWidth(true)-c.navClose.getWidth()-10;c.details.setWidth((f>0?f:0)+"px");c.caption.update(a[d][1]);c.caption.show();if(a.length>1){c.imageNumber.update(this.labelImage+" "+(d+1)+" "+this.labelOf+"  "+a.length);c.imageNumber.show()}c.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var g=this.getViewSize();c.overlay.setHeight(g[1]+"px");this.updateNav()}})},updateNav:function(){this.enableKeyNav();c.hoverNav.show();if(d>0){c.navPrev.show()}if(d<(a.length-1)){c.navNext.show()}},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this)},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this)},keyNavAction:function(f){var g=f.getKey();if(g==88||g==67||g==27){this.close()}else{if(g==80||g==37){if(d!=0){this.setImage(d-1)}}else{if(g==78||g==39){if(d!=(a.length-1)){this.setImage(d+1)}}}}},preloadImages:function(){var f,g;if(a.length>d+1){f=new Image();f.src=a[d+1][0]}if(d>0){g=new Image();g.src=a[d-1][0]}},close:function(){this.disableKeyNav();c.lightbox.hide();c.overlay.fadeOut({duration:this.overlayDuration});c.shim.hide();this.fireEvent("close",d)},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()]}}})();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);