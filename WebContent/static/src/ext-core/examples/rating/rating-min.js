Ext.ns("Ext.ux");Ext.ux.Rating=Ext.extend(Ext.util.Observable,{starWidth:16,split:1,resetValue:"",defaultSelected:-1,selected:-1,showTitles:true,constructor:function(b,a){Ext.apply(this,a);Ext.ux.Rating.superclass.constructor.call(this);this.addEvents("change","reset");this.el=Ext.get(b);this.init()},init:function(){var a=this;this.values=[];this.titles=[];this.stars=[];this.container=this.el.createChild({cls:"ux-rating-container ux-rating-clearfix"});if(this.canReset){this.resetEl=this.container.createChild({cls:"ux-rating-reset",cn:[{tag:"a",title:this.showTitles?(this.resetTitle||"Reset your vote"):"",html:"Reset"}]});this.resetEl.visibilityMode=Ext.Element.DISPLAY;this.resetEl.hover(function(){Ext.fly(this).addClass("ux-rating-reset-hover")},function(){Ext.fly(this).removeClass("ux-rating-reset-hover")});this.resetEl.on("click",this.reset,this)}this.radioBoxes=this.el.select("input[type=radio]");this.radioBoxes.each(this.initStar,this);this.input=this.container.createChild({tag:"input",type:"hidden",name:this.name,value:this.values[this.defaultSelected]||this.resetValue});this.radioBoxes.remove();this.select(this.defaultSelected===undefined?false:this.defaultSelected);if(this.disabled){this.disable()}else{this.enable()}},initStar:function(d,c,b){var a=Math.floor(this.starWidth/this.split);if(b==0){this.name=d.dom.name;this.disabled=d.dom.disabled}this.values[b]=d.dom.value;this.titles[b]=d.dom.title;if(d.dom.checked){this.defaultSelected=b}var g=this.container.createChild({cls:"ux-rating-star"});var f=g.createChild({tag:"a",html:this.values[b],title:this.showTitles?this.titles[b]:""});if(this.split){var e=(b%this.split);g.setWidth(a);f.setStyle("margin-left","-"+(e*a)+"px")}this.stars.push(g.dom)},onStarClick:function(b,a){if(!this.disabled){this.select(this.stars.indexOf(a))}},onStarOver:function(b,a){if(!this.disabled){this.fillTo(this.stars.indexOf(a),true)}},onStarOut:function(b,a){if(!this.disabled){this.fillTo(this.selected,false)}},reset:function(b,a){this.select(-1)},select:function(a){if(a===false||a===-1){this.value=this.resetValue;this.title="";this.input.dom.value="";if(this.canReset){this.resetEl.setOpacity(0.5)}this.fillNone();if(this.selected!==-1){this.fireEvent("change",this,this.values[a],this.stars[a])}this.selected=-1}else{if(a!==this.selected){this.selected=a;this.value=this.values[a];this.title=this.titles[a];this.input.dom.value=this.value;if(this.canReset){this.resetEl.setOpacity(0.99)}this.fillTo(a,false);this.fireEvent("change",this,this.values[a],this.stars[a])}}},fillTo:function(a,b){if(a!=-1){var c=b?"ux-rating-star-hover":"ux-rating-star-on";var d=b?"ux-rating-star-on":"ux-rating-star-hover";Ext.each(this.stars.slice(0,a+1),function(){Ext.fly(this).removeClass(d).addClass(c)});Ext.each(this.stars.slice(a+1),function(){Ext.fly(this).removeClass([d,c])})}else{this.fillNone()}},fillNone:function(){this.container.select(".ux-rating-star").removeClass(["ux-rating-star-hover","ux-rating-star-on"])},enable:function(){if(this.canReset){this.resetEl.show()}this.input.dom.disabled=null;this.disabled=false;this.container.removeClass("ux-rating-disabled");this.container.on({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"})},disable:function(){if(this.canReset){this.resetEl.hide()}this.input.dom.disabled=true;this.disabled=true;this.container.addClass("ux-rating-disabled");this.container.un({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"})},getValue:function(){return this.values[this.selected]||this.resetValue},destroy:function(){this.disable();this.container.remove();this.radioBoxes.appendTo(this.el);if(this.selected!==-1){this.radioBoxes.elements[this.selected].checked=true}}});